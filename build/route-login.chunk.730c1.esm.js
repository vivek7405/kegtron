(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{IMbM:function(t,e,a){"use strict";a.d(e,"a",(function(){return n}));var s=a("jmCe"),o=a("czhI").default;class n{}n.getDevices=t=>{o.get(s.a.mdashURL+"/customer?access_token="+localStorage.ktok).then((function(e){var a={},n=Object.keys(e.data.pubkeys||{}).map((function(t){var e=s.a.mdashURL+"/api/v2/m/device?access_token="+encodeURIComponent(t);return o({method:"GET",url:e}).then((function(e){a[t]=e.data})).catch((function(){}))}));Promise.all(n).then((function(){t.setState({devices:a})}))}))},n.getAllServings=t=>{o.get(s.a.mdashURL+"/customer?access_token="+localStorage.ktok).then((function(e){var a={},n=e.data.pubkeys||{},i=Object.keys(n).map((function(t){var e=s.a.mdashURL+"/api/v2/m/device/data/servings_all?access_token="+encodeURIComponent(t);return o({method:"GET",url:e}).then((function(e){a[t]=e.data})).catch((function(){}))}));Promise.all(i).then((function(){t.setState({servings:a,pubkeys:n})}))}))}},jmCe:function(t,e){"use strict";e.a={baseURL:"http://localhost:8080/",provisionURL:"http://192.168.4.1",mdashURL:"https://mdash.net",appID:"",callTimeoutMilli:1e4,defaultSiteName:"NewSite",drinkSizes:{1e3:"Liter (1000 mL)",500:"Half Liter (500 mL)",651:"Bomber (651 mL)",568:"UK Pint (568 mL)",473:"US Pint (473 mL)",355:"US Bottle (355 mL)",0:"Custom"},drinkSizes_US:{1e3:"Liter (33.8oz)",500:"Half Liter (16.9 oz)",651:"Bomber (22.0 oz)",568:"UK Pint (19.2 oz)",473:"US Pint (16 oz)",355:"US Bottle (12 oz)",0:"Custom"},kegSizes:{9464:"Half Corny (9.5L)",18927:"Corny (18.9L)",19550:"1/6 Barrel (19.6L)",2e4:"20L",25e3:"25L",29340:"1/4 Barrel (29.3L)",3e4:"30L",40915:"Firkin (40.9L)",5e4:"50L",58670:"1/2 Barrel (58.7L)",0:"Custom"},kegSizes_US:{9464:"Half Corny (2.5 gal)",18927:"Corny (5 gal)",19550:"1/6 Barrel (5.16 gal)",2e4:"20L (5.28 gal)",25e3:"25L (6.6 gal)",29340:"1/4 Barrel (7.75 gal)",3e4:"30L (7.93 gal)",40915:"Firkin (10.81 gal)",5e4:"50L (13.21 gal)",58670:"1/2 Barrel (15.5 gal)",0:"Custom"}}},m55C:function(t){t.exports={login:"login__1zeTF"}},n6wl:function(t,e,a){"use strict";a.r(e);var s=a("hosL"),o=a("Y3FI"),n=a("eWb4");a("ylD8");class i extends s.Component{constructor(t){super(t),this.onToggle=t=>{t.preventDefault(),this.setState({expanded:!this.state.expanded})},this.state={expanded:t.expanded||!1}}render(){this.state.expanded||this.props.dnone&&Object(s.h)("div",{class:"d-none"},this.props.children);return Object(s.h)("span",{class:this.props.class||"",style:"z-index: 999"},Object(s.h)("a",{onClick:this.onToggle,href:"#"},this.props.text||"",Object(s.h)("i",{class:"ml-2 fa "+(this.state.expanded?"fa-caret-down":"fa-caret-right")})),this.props.extra,this.state.expanded?this.props.children:this.props.dnone?Object(s.h)("div",{class:"d-none"},this.props.children):null)}}var r=a("m55C"),l=a.n(r),c=a("jmCe"),h=a("IMbM");a.d(e,"default",(function(){return p}));var d=a("czhI").default;class p extends s.Component{constructor(t){super(t),this.componentDidMount=()=>{var t=this;localStorage.ktok&&o.Router.route("/sites"),window.app=t,t.state.devices={};var e={},a="",s=location.href.match(/\?(\w+)=(.+)$/);s&&"creds"==s[1]&&s[2]?e.headers={Authorization:"Basic "+btoa(decodeURIComponent(s[2]))}:s&&"access_token"==s[1]&&s[2]&&(a=s[2]),a||(a=localStorage.ktok);var n=a?"?access_token="+a:"";(e.headers||n)&&d.get(c.a.mdashURL+"/customer"+n,e).then((function(e){t.login(e.data)})).catch((function(){}))},this.login=t=>{t&&t.token&&(localStorage.ktok=t.token,this.props.app.setState({ktok:t.token}),h.a.getDevices(this.props.app),h.a.getAllServings(this.props.app)),location.href.indexOf("?")>0&&(location.href=location.href.replace(/\?.*/,""))},this.onEmailInput=t=>{this.setState({email:t.target.value})},this.onPasswordInput=t=>{this.setState({pass:t.target.value})},this.onSignIn=()=>{var t=this;return d.get(c.a.mdashURL+"/customer",{headers:{Authorization:"Basic "+btoa(t.state.email+":"+t.state.pass)}}).then((function(e){t.login(e.data),o.Router.route("/sites")})).catch((function(t){alert((((t.response||{}).data||{}).error||{}).message||t.message||t)}))},this.onSendInvitation=()=>{var t=this,e=c.a.appID||location.pathname.split("/")[2]||"setme",a={email:t.state.email,url:c.a.mdashURL,from:"Kegtron",redir:location.href,app_id:e,text:"Thank you for registering with Kegtron.\nYour login: EMAIL\nYour password: PASS\nClick on the link below to activate your account and login:\nREGLINK"};return d.post(c.a.mdashURL+"/invite",a).then((function(){alert("Thank you! Check your inbox and login."),t.setState({email:""}),location.reload()})).catch((function(t){alert((((t.response||{}).data||{}).error||{}).message||t.message||t)}))},this.state={email:"",pass:""}}render(){return Object(s.h)("div",{class:l.a.login,style:"width:100%; height: 100%; background-color: #000"},Object(s.h)("div",{class:"mx-auto bg-light rounded",style:"max-width: 480px"},Object(s.h)("img",{src:"assets/images/Kegtron Cloud Dashboard - bw.png",class:"img-fluid"}),Object(s.h)("div",{class:"form p-3 rounded w-100"},Object(s.h)("input",{type:"email",placeholder:"Email",class:"my-2 form-control",onInput:this.onEmailInput}),Object(s.h)("input",{type:"password",placeholder:"Password",class:"my-2 form-control",onInput:this.onPasswordInput}),Object(s.h)(n.a,{class:"btn-block btn-secondary",disabled:!this.state.email||!this.state.pass,title:"Sign In",style:"backgroundColor: #000",icon:"fa-sign-in",onClick:this.onSignIn}),Object(s.h)("div",{class:"mt-2"},"No account yet?",Object(s.h)(i,{text:" Register",class:"black-text"},Object(s.h)("div",null,Object(s.h)("input",{type:"email",placeholder:"Email",class:"my-2 form-control",onInput:this.onEmailInput}),Object(s.h)(n.a,{class:"btn-block btn-secondary",icon:"fa-envelope",style:"backgroundColor: #000",title:"Send invitation",disabled:!this.state.email,onClick:this.onSendInvitation})))),Object(s.h)("div",{class:"mt-2"},Object(s.h)("small",null,"By using this service, you agree to the",Object(s.h)("a",{href:"https://policies.google.com/terms",class:"black-text"}," terms"))))))}}},ylD8:function(t){t.exports={toggle:"toggle__2CfFO"}}}]);
//# sourceMappingURL=route-login.chunk.730c1.esm.js.map