(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{R2Tw:function(t){t.exports={reports:"reports__24zUv"}},WHFn:function(t,e,l){"use strict";function n(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}l.r(e),l.d(e,"default",(function(){return h}));var r=l("hosL"),a=l("eWb4"),s=(l("R2Tw"),l("IMbM")),c=l("TiKg"),o=l.n(c),h=function(t){function e(e){var l;return(l=t.call(this,e)||this).getHeader=function(){var t=n(l);return Object(r.h)("div",null,Object(r.h)("div",{class:"col-12 d-flex justify-content-center form-inline",style:"flex-wrap: wrap"},Object(r.h)("div",{class:"d-flex form-inline"},Object(r.h)("input",{type:"radio",name:"servings",value:"keg",checked:t.state.servingsByKegChecked,onChange:t.servingsByChanged})," ",Object(r.h)("label",{class:"col-form-label"},"Servings By Keg")),Object(r.h)("div",{class:"d-flex form-inline",style:"margin-left: 3%"},Object(r.h)("input",{type:"radio",name:"servings",value:"time",checked:t.state.servingsByTimeChecked,onChange:t.servingsByChanged})," ",Object(r.h)("label",{class:"col-form-label"},"Servings By Time"))),Object(r.h)("br",null),Object(r.h)("div",{class:"col-12 d-flex justify-content-center",style:"flex-wrap: wrap"},Object(r.h)("div",{class:"col-4 d-flex justify-content-center form-inline"},Object(r.h)("label",{class:"col-form-label"},"Range"),Object(r.h)("select",{class:"form-control",style:"margin-left: 2%",type:"text",value:t.state.selectedDateOption,onChange:t.dateOptionChanged},Object(r.h)("option",{value:"today"},"Today"),Object(r.h)("option",{value:"yesterday"},"Yesterday"),Object(r.h)("option",{value:"weekToDate"},"Week to Date"),Object(r.h)("option",{value:"lastWeek"},"Last Week"),Object(r.h)("option",{value:"monthToDate"},"Month To Date"),Object(r.h)("option",{value:"lastMonth"},"Last Month"),Object(r.h)("option",{value:"yearToDate"},"Year to Date"),Object(r.h)("option",{value:"custom"},"Custom"))),"custom"==t.state.selectedDateOption&&Object(r.h)("div",{class:"col-4 d-flex justify-content-center form-inline"},Object(r.h)("label",{class:"col-form-label"},"Start"),Object(r.h)("input",{class:"form-control",style:"margin-left: 2%",type:"date",value:t.state.start,onChange:t.startDateChanged})),"custom"==t.state.selectedDateOption&&Object(r.h)("div",{class:"col-4 d-flex justify-content-center form-inline"},Object(r.h)("label",{class:"col-form-label"},"End"),Object(r.h)("input",{class:"form-control",style:"margin-left: 2%",type:"date",value:t.state.end,onChange:t.endDateChanged})),"custom"!=t.state.selectedDateOption&&Object(r.h)("div",{class:"col-4 d-flex justify-content-center form-inline"},Object(r.h)("label",{class:"col-form-label"},"Start"),Object(r.h)("input",{disabled:!0,class:"form-control",style:"margin-left: 2%",type:"date",value:t.state.start,onChange:t.startDateChanged})),"custom"!=t.state.selectedDateOption&&Object(r.h)("div",{class:"col-4 d-flex justify-content-center form-inline"},Object(r.h)("label",{class:"col-form-label"},"End"),Object(r.h)("input",{disabled:!0,class:"form-control",style:"margin-left: 2%",type:"date",value:t.state.end,onChange:t.endDateChanged}))),Object(r.h)("br",null),Object(r.h)("div",{class:"col-12 d-flex justify-content-center",style:"flex-wrap: wrap"},Object(r.h)(a.a,{class:"d-inline-block ml-3 btn-warning font-weight-light",style:"background-color: antiquewhite",icon:"fa-print",title:"Print",onClick:t.print}),Object(r.h)(a.a,{class:"d-inline-block ml-3 btn-warning font-weight-light",style:"background-color: antiquewhite",icon:"fa-file-excel-o",title:"Export As CSV",onClick:t.exportAsCSV})))},l.dateOptionChanged=function(t){var e,n,r="YYYY-MM-DD",a=t.srcElement.value;"today"==a?(e=o()().format(r),n=o()().format(r)):"yesterday"==a?(e=o()().add(-1,"days").format(r),n=o()().add(-1,"days").format(r)):"weekToDate"==a?(e=o()().startOf("isoWeek").format(r),n=o()().format(r)):"lastWeek"==a?(e=o()().subtract(1,"weeks").startOf("isoWeek").format(r),n=o()().subtract(1,"weeks").endOf("isoWeek").format(r)):"monthToDate"==a?(e=o()().startOf("month").format(r),n=o()().format(r)):"lastMonth"==a?(e=o()().subtract(1,"months").startOf("month").format(r),n=o()().subtract(1,"months").endOf("month").format(r)):"yearToDate"==a?(e=o()().startOf("year").format(r),n=o()().format(r)):(e="",n=""),l.setState({selectedDateOption:a,start:e,end:n})},l.startDateChanged=function(t){l.setState({start:t.srcElement.value})},l.endDateChanged=function(t){l.setState({end:t.srcElement.value})},l.servingsByChanged=function(){var t=n(l);t.setState({servingsByKegChecked:!t.state.servingsByKegChecked,servingsByTimeChecked:!t.state.servingsByTimeChecked})},l.print=function(){var t=document.getElementById("nodeToRenderAsPDF").innerHTML,e=window.open("","","height=400,width=800");e.document.write("<html><head><title>Kegtron Serving Report</title>"),e.document.write("</head><body>"),e.document.write(t),e.document.write("</body></html>"),e.document.close(),e.print()},l.downloadCSV=function(t,e){var l,n;l=new Blob([t],{type:"text/csv"}),(n=document.createElement("a")).download=e,n.href=window.URL.createObjectURL(l),n.style.display="none",document.body.appendChild(n),n.click()},l.exportAsCSV=function(){for(var t=[],e=document.getElementById("servingsForCSV").querySelectorAll("table tr"),n=0;n<e.length;n++){for(var r=[],a=e[n].querySelectorAll("td, th"),s=0;s<a.length;s++)r.push(a[s].innerText);t.push(r.join(","))}l.downloadCSV(t.join("\n").replace("Serving Report: ",""),"Kegtron Serving Report.csv")},l.mlToUnits=function(t,e){return e?e.displayUnits?+t+" mL":(.033814*+t).toFixed(1)+" oz":+t+" mL"},l.mlToUnitsWoUnit=function(t,e){return e?e.displayUnits?+t:(.033814*+t).toFixed(1):+t},l.mlToUnits2=function(t,e){return e?e.displayUnits?(t/1e3).toFixed(2)+" L":(t/3785.41).toFixed(2)+" gal":(t/1e3).toFixed(2)+" L"},l.getServingsForCSV=function(){var t,e,a=n(l),s=a.props.app.state.devices,c=0,h=new Array;if(0!=Object.keys(s).length){for(var i in a.props.app.state.pubkeys){var b=s[i].id,u=s[i].shadow.state.reported.config;e=u;var d=a.props.app.state.servings[i];if(null!=d&&d.rows.length>0)for(var O=0;O<u.portCount;O++){var j=u["port"+O];if(null!=j){var p=j.userName,v=0;for(var g in d.rows){var f=d.rows[g];if(b==f[1]){var m=JSON.parse(f[3]);if(m.port==O&&m.vol>0){var y=o.a.utc(f[0]).local().format("YYYY-MM-DD");if(y>=a.state.start&&y<=a.state.end){var w=o.a.utc(f[0]).local().format("YYYY-MM-DD");if(w>=a.state.start&&w<=a.state.end){w=o.a.utc(f[0]).local().format("YYYY-MM-DD HH:mm");var D=JSON.parse(f[3]);h.push(Object(r.h)("tr",null,Object(r.h)("td",null,w),Object(r.h)("td",null,p),Object(r.h)("td",null,a.mlToUnitsWoUnit(D.vol,u))))}v++}}}}v>0&&(c+=v)}}}if(c>0){var S="mL";e&&(S=e.displayUnits?"mL":"oz"),t=Object(r.h)("table",{border:"1",style:"text-align: center; width: 100%"},Object(r.h)("tr",null,Object(r.h)("th",null,"Date / Time"),Object(r.h)("th",null,"Keg Name"),Object(r.h)("th",null,"Serving Size (",S,")")),h)}else t=Object(r.h)("table",{border:"0"},Object(r.h)("tr",null,Object(r.h)("td",null,"No data available for selected range.")))}return t},l.getServingsByKeg=function(){var t=n(l),e=t.props.app.state.devices,a=new Array,s=new Array,c=0,h=0,i=void 0;if(0!=Object.keys(e).length){for(var b in t.props.app.state.pubkeys){var u=e[b].id,d=e[b].shadow.state.reported.config;i=d;var O=t.props.app.state.servings[b];if(null!=O&&O.rows.length>0){O.rows.sort();for(var j=0;j<d.portCount;j++){var p,v=new Array,g=d["port"+j];if(null!=g){var f=g.userName,m=g.userDesc,y=t.mlToUnits2(g.volSize,d),w=g.dateTapped?o()(g.dateTapped||void 0).fromNow().replace(" ago",""):"-";p=Object(r.h)("table",{border:"0"},Object(r.h)("tr",null,Object(r.h)("td",null,"Name"),Object(r.h)("td",null,": ",Object(r.h)("b",null,f))),Object(r.h)("tr",null,Object(r.h)("td",null,"Description"),Object(r.h)("td",null,": ",Object(r.h)("b",null,m))),Object(r.h)("tr",null,Object(r.h)("td",null,"Keg Size"),Object(r.h)("td",null,": ",Object(r.h)("b",null,y))),Object(r.h)("tr",null,Object(r.h)("td",null,"Days On Tap"),Object(r.h)("td",null,": ",Object(r.h)("b",null,w))));var D=0,S=0;for(var T in O.rows){var k=O.rows[T];if(u==k[1]){var Y=o.a.utc(k[0]).local().format("YYYY-MM-DD");if(Y>=t.state.start&&Y<=t.state.end){Y=o.a.utc(k[0]).local().format("YYYY-MM-DD HH:mm");var C=JSON.parse(k[3]);C.port==j&&C.vol>0&&(v.push(Object(r.h)("tr",null,Object(r.h)("td",null,Y),Object(r.h)("td",null,t.mlToUnits(C.vol,d)))),S+=C.vol,D++)}}}if(D>0){c+=D,h+=S;var x=Object(r.h)("table",{border:"1",style:"text-align: center; width: 100%"},Object(r.h)("tr",null,Object(r.h)("th",null,"Date / Time"),Object(r.h)("th",null,"Serving Size")),v);a.push(Object(r.h)("div",null,p)),a.push(Object(r.h)("table",{border:"0"},Object(r.h)("tr",null,Object(r.h)("td",null,Object(r.h)("br",null))))),a.push(Object(r.h)("div",null,x)),a.push(Object(r.h)("table",{border:"0"},Object(r.h)("tr",null,Object(r.h)("td",null,Object(r.h)("br",null))))),a.push(Object(r.h)("table",{border:"0"},Object(r.h)("tr",null,Object(r.h)("td",null,Object(r.h)("b",null,"Total Servings: "),D,", ",Object(r.h)("b",null,"Total Volume: "),t.mlToUnits2(S,d))))),a.push(Object(r.h)("table",{border:"0"},Object(r.h)("tr",null,Object(r.h)("td",null,Object(r.h)("br",null),Object(r.h)("br",null))))),s.push(Object(r.h)("tr",null,Object(r.h)("td",null,f),Object(r.h)("td",null,D),Object(r.h)("td",null,t.mlToUnits2(S,d))))}}}}}if(s.length>0){a.splice(0,0,Object(r.h)("table",{border:"0",style:"text-align: center; width: 100%"},Object(r.h)("tr",null,Object(r.h)("td",{style:"font-size: x-large"},Object(r.h)("b",null,"Serving Report: ",t.state.start," - ",t.state.end),Object(r.h)("br",null),Object(r.h)("br",null))))),a.splice(0,0,Object(r.h)("table",{border:"0",style:"text-align: center; width: 100%"},Object(r.h)("tr",null,Object(r.h)("td",null,Object(r.h)("br",null),Object(r.h)("img",{src:"/assets/images/KegtronLogoBlack.png",height:"24"}),Object(r.h)("br",null)))));var M=Object(r.h)("table",{border:"1",style:"text-align: center; width: 100%"},Object(r.h)("tr",null,Object(r.h)("th",null,"Keg Name"),Object(r.h)("th",null,"Servings"),Object(r.h)("th",null,"Volume Served")),s);a.push(Object(r.h)("table",{border:"0",style:"text-align: center; width: 100%"},Object(r.h)("tr",null,Object(r.h)("td",{style:"font-size: x-large"},Object(r.h)("b",null,"Grand Total"),Object(r.h)("br",null),Object(r.h)("br",null))))),a.push(Object(r.h)("div",{style:"text-align: center"},M)),a.push(Object(r.h)("table",{border:"0"},Object(r.h)("tr",null,Object(r.h)("td",null,Object(r.h)("br",null))))),a.push(Object(r.h)("table",{border:"0"},Object(r.h)("tr",null,Object(r.h)("td",null,Object(r.h)("b",null,"Total Servings: "),c,", ",Object(r.h)("b",null,"Total Volume: "),t.mlToUnits2(h,i))))),a.push(Object(r.h)("table",{border:"0"},Object(r.h)("tr",null,Object(r.h)("td",null,Object(r.h)("br",null),Object(r.h)("br",null)))))}else(a=new Array).push(Object(r.h)("table",{border:"0"},Object(r.h)("tr",null,Object(r.h)("td",null,"No data available for selected range."))))}return a},l.getServingsByTime=function(){var t,e=n(l),a=e.props.app.state.devices,s=new Array,c=new Array,h=0,i=0,b=new Array;if(0!=Object.keys(a).length){for(var u in e.props.app.state.pubkeys){var d=a[u].id,O=a[u].shadow.state.reported.config;t=O;var j=e.props.app.state.servings[u];if(null!=j&&j.rows.length>0)for(var p=0;p<O.portCount;p++){var v=O["port"+p];if(null!=v){var g=v.userName,f=0,m=0;for(var y in j.rows){var w=j.rows[y];if(d==w[1]){var D=JSON.parse(w[3]);if(D.port==p&&D.vol>0){var S=o.a.utc(w[0]).local().format("YYYY-MM-DD");if(S>=e.state.start&&S<=e.state.end){var T=o.a.utc(w[0]).local().format("YYYY-MM-DD");if(T>=e.state.start&&T<=e.state.end){T=o.a.utc(w[0]).local().format("YYYY-MM-DD HH:mm");var k=JSON.parse(w[3]);b.push(Object(r.h)("tr",null,Object(r.h)("td",null,T),Object(r.h)("td",null,g),Object(r.h)("td",null,e.mlToUnits(k.vol,O))))}m+=D.vol,f++}}}}f>0&&(h+=f,i+=m,c.push(Object(r.h)("tr",null,Object(r.h)("td",null,g),Object(r.h)("td",null,f),Object(r.h)("td",null,e.mlToUnits2(m,O)))))}}}if(c.length>0){s.push(Object(r.h)("table",{border:"0",style:"text-align: center; width: 100%"},Object(r.h)("tr",null,Object(r.h)("td",null,Object(r.h)("br",null),Object(r.h)("img",{src:"/assets/images/KegtronLogoBlack.png",height:"24"}),Object(r.h)("br",null))))),s.push(Object(r.h)("table",{border:"0",style:"text-align: center; width: 100%"},Object(r.h)("tr",null,Object(r.h)("td",{style:"font-size: x-large"},Object(r.h)("b",null,"Serving Report: ",e.state.start," - ",e.state.end),Object(r.h)("br",null),Object(r.h)("br",null)))));var Y=Object(r.h)("table",{border:"1",style:"text-align: center; width: 100%"},Object(r.h)("tr",null,Object(r.h)("th",null,"Date / Time"),Object(r.h)("th",null,"Keg Name"),Object(r.h)("th",null,"Serving Size")),b);s.push(Y);var C=Object(r.h)("table",{border:"1",style:"text-align: center; width: 100%"},Object(r.h)("tr",null,Object(r.h)("th",null,"Keg Name"),Object(r.h)("th",null,"Servings"),Object(r.h)("th",null,"Volume Served")),c);s.push(Object(r.h)("table",{border:"0"},Object(r.h)("tr",null,Object(r.h)("td",null,Object(r.h)("br",null),Object(r.h)("br",null))))),s.push(Object(r.h)("table",{border:"0",style:"text-align: center; width: 100%"},Object(r.h)("tr",null,Object(r.h)("td",{style:"font-size: x-large"},Object(r.h)("b",null,"Grand Total"),Object(r.h)("br",null),Object(r.h)("br",null))))),s.push(Object(r.h)("div",{style:"text-align: center"},C)),s.push(Object(r.h)("table",{border:"0"},Object(r.h)("tr",null,Object(r.h)("td",null,Object(r.h)("br",null))))),s.push(Object(r.h)("table",{border:"0"},Object(r.h)("tr",null,Object(r.h)("td",null,Object(r.h)("b",null,"Total Servings: "),h,", ",Object(r.h)("b",null,"Total Volume: "),e.mlToUnits2(i,t))))),s.push(Object(r.h)("table",{border:"0"},Object(r.h)("tr",null,Object(r.h)("td",null,Object(r.h)("br",null),Object(r.h)("br",null)))))}else(s=new Array).push(Object(r.h)("table",{border:"0"},Object(r.h)("tr",null,Object(r.h)("td",null,"No data available for selected range."))))}return s},l.state={start:o()().format("YYYY-MM-DD"),end:o()().format("YYYY-MM-DD"),selectedDateOption:"today",servingsByKegChecked:!0,servingsByTimeChecked:!1},l}var l,c;c=t,(l=e).prototype=Object.create(c.prototype),l.prototype.constructor=l,l.__proto__=c;var h=e.prototype;return h.componentDidMount=function(){this.props.app.setState({headerName:"Reports",backlink:""}),this.props.app.state.servings&&0===Object.keys(this.props.app.state.servings).length&&this.props.app.state.servings.constructor===Object&&s.a.getAllServings(this.props.app),this.props.app.state.devices&&0===Object.keys(this.props.app.state.devices).length&&this.props.app.state.devices.constructor===Object&&s.a.getDevices(this.props.app)},h.render=function(){return Object(r.h)("div",{class:"overflow-auto p-2"},Object(r.h)("div",{class:"card-deck col-12"},Object(r.h)("div",{class:"card"},Object(r.h)("div",{class:"card-header font-weight-bold"},this.getHeader()),Object(r.h)("div",{id:"nodeToRenderAsPDF",class:"card-body table-responsive"},this.state.servingsByKegChecked&&this.getServingsByKeg(),this.state.servingsByTimeChecked&&this.getServingsByTime()),Object(r.h)("div",{id:"servingsForCSV",style:"display: none"},this.getServingsForCSV()))))},e}(r.Component)}}]);
//# sourceMappingURL=route-reports.chunk.365c2.js.map