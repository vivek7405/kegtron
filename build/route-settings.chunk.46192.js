(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{"5znX":function(e){e.exports={settings:"settings__1JFwH",portConfig:"portConfig__2M7mG"}},IMbM:function(e,t,o){"use strict";o.d(t,"a",(function(){return r}));var n=o("jmCe"),a=o("czhI").default,r=function(){};r.getDevices=function(e){a.get(n.a.mdashURL+"/customer?access_token="+localStorage.ktok).then((function(t){var o={},r=Object.keys(t.data.pubkeys||{}).map((function(e){var t=n.a.mdashURL+"/api/v2/m/device?access_token="+encodeURIComponent(e);return a({method:"GET",url:t}).then((function(t){o[e]=t.data})).catch((function(){}))}));Promise.all(r).then((function(){e.setState({devices:o})}))}))},r.getAllServings=function(e){a.get(n.a.mdashURL+"/customer?access_token="+localStorage.ktok).then((function(t){var o={},r=t.data.pubkeys||{},s=Object.keys(r).map((function(e){var t=n.a.mdashURL+"/api/v2/m/device/data/servings_all?access_token="+encodeURIComponent(e);return a({method:"GET",url:t}).then((function(t){o[e]=t.data})).catch((function(){}))}));Promise.all(s).then((function(){e.setState({servings:o,pubkeys:r})}))}))}},Y72v:function(){},jmCe:function(e,t){"use strict";t.a={baseURL:"http://localhost:8080/",provisionURL:"http://192.168.4.1",mdashURL:"https://mdash.net",appID:"",callTimeoutMilli:1e4,defaultSiteName:"NewSite",drinkSizes:{1e3:"Liter (1000 mL)",500:"Half Liter (500 mL)",651:"Bomber (651 mL)",568:"UK Pint (568 mL)",473:"US Pint (473 mL)",355:"US Bottle (355 mL)",0:"Custom"},drinkSizes_US:{1e3:"Liter (33.8oz)",500:"Half Liter (16.9 oz)",651:"Bomber (22.0 oz)",568:"UK Pint (19.2 oz)",473:"US Pint (16 oz)",355:"US Bottle (12 oz)",0:"Custom"},kegSizes:{9464:"Half Corny (9.5L)",18927:"Corny (18.9L)",19550:"1/6 Barrel (19.6L)",2e4:"20L",25e3:"25L",29340:"1/4 Barrel (29.3L)",3e4:"30L",40915:"Firkin (40.9L)",5e4:"50L",58670:"1/2 Barrel (58.7L)",0:"Custom"},kegSizes_US:{9464:"Half Corny (2.5 gal)",18927:"Corny (5 gal)",19550:"1/6 Barrel (5.16 gal)",2e4:"20L (5.28 gal)",25e3:"25L (6.6 gal)",29340:"1/4 Barrel (7.75 gal)",3e4:"30L (7.93 gal)",40915:"Firkin (10.81 gal)",5e4:"50L (13.21 gal)",58670:"1/2 Barrel (15.5 gal)",0:"Custom"}}},qFzw:function(){},yUQ5:function(){},yzNr:function(e,t,o){"use strict";function n(){return(n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e}).apply(this,arguments)}function a(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e}).apply(this,arguments)}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e}).apply(this,arguments)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}o.r(t);var c=o("hosL"),u=o("Y3FI"),p=o("5znX"),h=o.n(p),d=o("jmCe"),v=o("eWb4"),f=(o("Y72v"),function(e){function t(t){var o;return(o=e.call(this,t)||this).stringToString=function(e){return e},o.componentDidMount=function(){var e=a(o);e.normalize=e.props.normalize||e.stringToString,e.format=e.props.format||e.stringToString,e.setState({value:e.normalize(e.props.value)})},o.componentWillReceiveProps=function(e){var t=a(o);t.normalize=e.normalize||t.stringToString,t.format=e.format||t.stringToString,t.props.value!==e.value&&t.setState({value:t.normalize(e.value)})},o.handleInput=function(e){var t=a(o);t.setState({value:e.target.value}),t.props.onInput(t.format(e.target.value))},o.state={},o}var o,r;return r=e,(o=t).prototype=Object.create(r.prototype),o.prototype.constructor=o,o.__proto__=r,t.prototype.render=function(){return Object(c.h)("input",n({},this.props,{type:this.props.type||"text",value:this.state.value,onInput:this.handleInput}))},t}(c.Component)),m=(o("qFzw"),function(e){function t(t){var o;return(o=e.call(this,t)||this).componentDidMount=function(){var e=s(o);e.props.extraProps=e.props.extraProps||{},o.setState({value:e.props.valueResolver(e.props.k,e.props.extraProps.type)})},o.componentWillReceiveProps=function(){var e=s(o);e.props.extraProps=e.props.extraProps||{};var t=e.props.valueResolver(e.props.k,e.props.extraProps.type);t!==e.state.value&&e.setState({value:t})},o.state={},o}var o,n;return n=e,(o=t).prototype=Object.create(n.prototype),o.prototype.constructor=o,o.__proto__=n,t.prototype.render=function(){var e=this;return Object(c.h)("div",{class:"form-group row my-2"},Object(c.h)("label",{class:"col-form-label col-4"},e.props.label),Object(c.h)("div",{class:e.props.badge?"col-3":"col-8"},Object(c.h)(f,r({},e.props.extraProps,{value:e.state.value,placeholder:e.props.label,class:"form-control",onInput:function(t){if(e.props.onChange("c."+e.props.k,t),e.props.k.match(/.volSize$/)){var o=e.props.k.replace(".volSize",".volStart");e.props.onChange("c."+o,t)}}}))),e.props.badge?Object(c.h)("div",{class:"col-1 d-flex align-items-center"},e.props.badge):null)},t}(c.Component)),g=(o("yUQ5"),function(e){function t(t){var o;return(o=e.call(this,t)||this).closeModal=function(){self.props.onClose()},o.state={},o}var o,n;return n=e,(o=t).prototype=Object.create(n.prototype),o.prototype.constructor=o,o.__proto__=n,t.prototype.render=function(){var e;return e=this.props.open?Object(c.h)(Modal,{open:"true"},Object(c.h)("div",{class:"modal-dialog",role:"document"},Object(c.h)("div",{class:"modal-header"},Object(c.h)("h5",{class:"modal-title",id:"exampleModalLabel"},"Alert")),Object(c.h)("div",{class:"modal-body"},Object(c.h)("p",{class:"lead"},this.props.children)),Object(c.h)("div",{class:"modal-footer"},Object(c.h)("button",{type:"button",class:"btn btn-primary mx-auto btn-lg",onClick:this.closeModal},"OK")))):"",Object(c.h)("div",null,e)},t}(c.Component)),b=o("IMbM");o.d(t,"default",(function(){return R}));var k=o("czhI").default,R=function(e){function t(t){var o;return(o=e.call(this,t)||this).recursive=function(e,t,n){var a,r=l(o),s=t.splice(0,1)[0];return"object"!=typeof e?n:i({},e,((a={})[s]=r.recursive(e[s],t),a))},o.setNestedState=function(e,t,n){var a=l(o),r=t.split(".");e((function(e){a.recursive(e,r,n)}))},o.setKey=function(e,t,o){isNaN(o)||(o=Number(o));for(var n=t.split("."),a=0;a<n.length;a++)a>=n.length-1?e[n[a]]=o:(e[n[a]]||(e[n[a]]={}),e=e[n[a]])},o.getKey=function(e,t){for(var o=t.split("."),n=0;n<o.length;n++){if(!(o[n]in e))return;e=e[o[n]]}return e},o.handleMkRowChange=function(e,t){var n=l(o);n.setNestedState.bind(null,n.setState.bind(n))(e,t),n.setKey(n.state,e,t)},o.mkRowValueResolver=function(e,t){var n=l(o),a=n.state.d.shadow.state.reported,r=n.getKey(n.state.c,e);return void 0===r&&(r=n.getKey(a.config,e)),r="date"===t?r.replace(/\//g,"-"):r},o.onAutoKegReset=function(e){o.setState({autoKegResetAlertOpen:1==e})},o.closeAutoKegResetModal=function(){o.setState({autoKegResetAlertOpen:!1})},o.closeAutoKegResetModal=function(){o.setState({autoKegResetAlertOpen:!1})},o.getDevicePubkeyById=function(e,t){for(var o in e.state.devices){if(e.state.devices[o].id==t)return o}return null},o.drinkSizeIsCustom=function(e,t){return 0==t||e.every((function(e){return String(e.value)!==String(t)}))},o.kegSizeIsCustom=function(e,t){return 0==t||e.every((function(e){return String(e.value)!==String(t)}))},o.mkDropdownRow=function(e,t,n,a){var r=l(o),s=r.state.d.shadow.state.reported,i=r.isDisplayUnitMetric()?d.a.kegSizes:d.a.kegSizes_US,u=r.getKey(r.state.c,t);return void 0===u&&(u=r.getKey(s.config,t)),t.match(/volSize$/)?(u=Number(u))in i||(u=0):!t.match(/drinkSize$/)||u in d.a.drinkSizes||(u=0),Object(c.h)("div",{class:"form-group row my-2"},Object(c.h)("label",{class:"col-form-label col-4"},e),Object(c.h)("div",{class:"col-8"},Object(c.h)("select",{class:"form-control",type:"text",value:u,onChange:function(e){var o=e.target.value;r.setKey(r.state.c,t,o),a&&a(o),r.setState(r.state)}},n.map((function(e){return Object(c.h)("option",{value:e.value},e.title)})))))},o.litersToML=function(e){return 1e3*e},o.mLToLiters=function(e){return e/1e3},o.ouncesToLiter=function(e){return Number((.0295735296875*e).toFixed(3))},o.literToOunces=function(e){return Number((e/.0295735296875).toFixed(3))},o.millilitersToGallons=function(e){return Number((.26417*e/1e3).toFixed(3))},o.gallonsToMilliliters=function(e){return Number((e/.26417*1e3).toFixed(3))},o.curry=function(e,t,o){var n=[e,t,o];return function(e){return n.reduce((function(e,t){return t(e)}),e)}},o.curry=function(e,t){var o=[e,t];return function(e){return o.reduce((function(e,t){return t(e)}),e)}},o.isDisplayUnitMetric=function(){var e=l(o);return 0!==(void 0!==e.state.c.displayUnits?e.state.c.displayUnits:e.state.d.shadow.state.reported.config.displayUnits)},o.getPortConfigs=function(){var e=l(o),t=e.state.d.shadow.state.reported;t.config.chipID=((t.ota||{}).id||"").toUpperCase();var n=e.isDisplayUnitMetric(),a=d.a.drinkSizes,r=n?a:d.a.drinkSizes_US,s=Object.keys(r).map((function(e){return{value:Number(e),title:r[e]}}));s=s.sort((function(e,t){return+e.value<+t.value?1:-1}));var i=d.a.kegSizes,u=n?i:d.a.kegSizes_US,p=Object.keys(u).map((function(e){return{value:Number(e),title:u[e]}}));p.sort((function(e,t){return+e.value<+t.value?1:-1}));for(var f=[],g=function(o){var a="port"+o,r=a+".drinkSize",i=e.getKey(e.state.c,r);void 0===i&&(i=e.getKey(t.config,r));var l=a+".volSize",u=e.getKey(e.state.c,l);void 0===u&&(u=e.getKey(t.config,l));var g={format:n?Math.round.bind(Math):e.curry(e.litersToML,e.ouncesToLiter,Math.round.bind(Math)),normalize:n?Math.round.bind(Math):e.curry(e.mLToLiters,e.literToOunces,Math.round.bind(Math))},R={format:e.curry(n?e.litersToML:e.gallonsToMilliliters,Math.round.bind(Math)),normalize:e.curry(n?e.mLToLiters:e.millilitersToGallons,Math.round.bind(Math))};f.push(Object(c.h)("div",null,Object(c.h)("div",{class:h.a.portConfig},Object(c.h)("hr",null),"Port ",o+1),Object(c.h)(m,{onChange:e.handleMkRowChange,valueResolver:e.mkRowValueResolver,label:"Name",key:a+".userName",k:a+".userName"}),Object(c.h)(m,{onChange:e.handleMkRowChange,valueResolver:e.mkRowValueResolver,label:"Description",key:a+".userDesc",k:a+".userDesc"}),e.mkDropdownRow("Keg Size",a+".volSize",p,(function(t){e.setKey(e.state.c,a+".volStart",t),e.setKey(e.state.c,a+".isKegSizeCustom",0==t?1:0),e.setState(e.state)})),e.kegSizeIsCustom(p,void 0===e.getKey(e.state.c,a+".volSize")?e.getKey(t.config,a+".volSize"):e.getKey(e.state.c,a+".volSize"))?Object(c.h)(m,{onChange:e.handleMkRowChange,valueResolver:e.mkRowValueResolver,label:"",key:a+".volSize",k:a+".volSize",badge:n?"L":"gal",extraProps:R}):null,Object(c.h)(m,{onChange:e.handleMkRowChange,valueResolver:e.mkRowValueResolver,label:"Keg Volume Start "+(n?"(L)":"(gal)"),key:a+".volStart",k:a+".volStart",extraProps:R}),e.mkDropdownRow("Serving Size",a+".drinkSize",s,(function(t){e.setKey(e.state.c,a+".isDrinkSizeCustom",0==t?1:0),e.setState(e.state)})),e.drinkSizeIsCustom(s,void 0===e.getKey(e.state.c,a+".drinkSize")?e.getKey(t.config,a+".drinkSize"):e.getKey(e.state.c,a+".drinkSize"))?Object(c.h)(m,{onChange:e.handleMkRowChange,valueResolver:e.mkRowValueResolver,label:"",key:a+".drinkSize",k:a+".drinkSize",badge:n?"mL":"oz",extraProps:g}):null,Object(c.h)(m,{onChange:e.handleMkRowChange,valueResolver:e.mkRowValueResolver,label:"Cal. Offset %",key:a+".calOffset",k:a+".calOffset"}),Object(c.h)(m,{onChange:e.handleMkRowChange,valueResolver:e.mkRowValueResolver,label:"Date Tapped",key:a+".dateTapped",k:a+".dateTapped",extraProps:{type:"date"}}),Object(c.h)(m,{onChange:e.handleMkRowChange,valueResolver:e.mkRowValueResolver,label:"Date Cleaned",key:a+".dateCleaned",k:a+".dateCleaned",extraProps:{type:"date"}}),Object(c.h)("div",{class:"form-group row my-2"},Object(c.h)("label",{class:"col-form-label col-4"},"Volume Reset"),Object(c.h)("div",{class:"col-8"},Object(c.h)(v.a,{class:"btn-block btn-warning",icon:"fa-minus-square",title:"Reset Keg Volume",onClick:function(){if(confirm("Sure to reset this volume?")){var t=d.a.mdashURL+"/api/v2/m/device/rpc/Kegtron.ResetVolume?access_token="+encodeURIComponent(e.state.pubkey);return k({method:"POST",url:t,data:{port:o}}).then((function(){t=t.replace("/rpc/Kegtron.ResetVolume","");var e={};return e["port"+o]={dateCleaned:null,dateTapped:null},k({method:"POST",url:t,data:{shadow:{state:{desired:{config:e}}}}})})).catch((function(){})).then((function(){setTimeout((function(){b.a.getDevices(e.props.app)}),250)}))}}})))))},R=0;R<t.config.portCount;R++)g(R);return f},o.removeUnNecessaryProps=function(e){var t=i({},e),o=["isKegSizeCustom","isDrinkSizeCustom","isServingSizeCustom"];return Object.keys(t).forEach((function(e){o.forEach((function(o){return delete t[e][o]}))})),console.log(t),t},o.saveConfiguration=function(){var e=l(o),t=d.a.mdashURL+"/api/v2/m/device?access_token="+encodeURIComponent(e.state.pubkey),n={shadow:{state:{desired:{config:e.removeUnNecessaryProps(e.state.c)}}}};return k({method:"POST",url:t,data:n}).then((function(){e.state.c.siteName&&(u.Router.route("/config/"+e.state.c.siteName+"/"+e.props.id+"/"+e.props.port),e.props.name=e.state.c.siteName,e.componentDidMount()),setTimeout((function(){b.a.getDevices(e.props.app)}),750)})).catch((function(){}))},o}var o,n;n=e,(o=t).prototype=Object.create(n.prototype),o.prototype.constructor=o,o.__proto__=n;var a=t.prototype;return a.componentDidMount=function(){var e=this.props;e.app.setState({headerName:"Settings / "+e.name+" / "+e.id+" / "+(+this.props.port+1),backlink:"/sites/"+e.name}),this.props.app.state.devices&&0===Object.keys(this.props.app.state.devices).length&&this.props.app.state.devices.constructor===Object&&b.a.getDevices(this.props.app)},a.componentWillReceiveProps=function(e){var t=this.getDevicePubkeyById(e.app,e.id);t&&this.setState({pubkey:t,c:{},d:e.app.state.devices[t]})},a.render=function(){if(this.state.d){var e=this.state.d.shadow.state.reported,t=this.getPortConfigs();return Object(c.h)("div",{class:h.a.settings},Object(c.h)("div",{class:"overflow-auto p-2 font-weight-light"},Object(c.h)("div",{class:"px-2 my-2"},this.state.d.id,":",Object(c.h)("b",{class:e.online?"text-success font-weight-bold":"font-weight-bold text-danger"},e.online?" online":" offline")),Object(c.h)("hr",null),Object(c.h)("form",{class:"form px-2"},Object(c.h)(m,{onChange:this.handleMkRowChange,valueResolver:this.mkRowValueResolver,label:"Site Name",k:"siteName"}),Object(c.h)(m,{onChange:this.handleMkRowChange,valueResolver:this.mkRowValueResolver,label:"Alert Email",k:"alertEmail"}),this.mkDropdownRow("Low Alarm","lowThresholdAlertEna",[{value:0,title:"Disable"},{value:1,title:"Enable"}]),Object(c.h)(m,{onChange:this.handleMkRowChange,valueResolver:this.mkRowValueResolver,label:"Low Threshold %",k:"lowThreshold"}),this.mkDropdownRow("Empty Alarm","emptyThresholdAlertEna",[{value:0,title:"Disable"},{value:1,title:"Enable"}]),Object(c.h)(m,{onChange:this.handleMkRowChange,valueResolver:this.mkRowValueResolver,label:"Empty Threshold %",k:"emptyThreshold"}),Object(c.h)(m,{onChange:this.handleMkRowChange,valueResolver:this.mkRowValueResolver,label:"Ports",k:"portCount",extraProps:{disabled:!0}}),Object(c.h)(m,{onChange:this.handleMkRowChange,valueResolver:this.mkRowValueResolver,label:"Hardware",k:"hwRev",extraProps:{disabled:!0}}),Object(c.h)(m,{onChange:this.handleMkRowChange,valueResolver:this.mkRowValueResolver,label:"Firmware",k:"fwRev",extraProps:{disabled:!0}}),Object(c.h)(m,{onChange:this.handleMkRowChange,valueResolver:this.mkRowValueResolver,label:"Serial Number",k:"chipID",extraProps:{disabled:!0}}),Object(c.h)(m,{onChange:this.handleMkRowChange,valueResolver:this.mkRowValueResolver,label:"Model",k:"modelNum",extraProps:{disabled:!0}}),this.mkDropdownRow("Display Units","displayUnits",[{value:0,title:"US Customary"},{value:1,title:"Metric"}]),this.mkDropdownRow("Cleaning Mode","cleanEna",[{value:0,title:"Disable"},{value:1,title:"Enable"}]),this.mkDropdownRow("Beacon Mode","beaconEna",[{value:0,title:"Disable"},{value:1,title:"Enable"}]),this.mkDropdownRow("Auto Keg Reset","autoCounterRstEna",[{value:0,title:"Disable"},{value:1,title:"Enable"}],this.onAutoKegReset),Object(c.h)(g,{open:this.state.autoKegResetAlertOpen,onClose:this.closeAutoKegResetModal},"For best Auto Keg Reset performance, ensure Reset Keg Volume is applied when the first keg is tapped. Calibrating your tap is also recommended."),t,Object(c.h)(v.a,{class:"btn-block btn-primary mt-5",title:"Save Configuration",icon:"fa-save",onClick:this.saveConfiguration}))))}return Object(c.h)("div",{class:h.a.settings},Object(c.h)("div",{class:"h-100 d-flex align-items-center"},Object(c.h)("div",{class:"text-center w-100 text-muted"},Object(c.h)("span",{class:"fa fa-refresh fa-spin fa-2x"}),Object(c.h)("br",null))))},t}(c.Component)}}]);
//# sourceMappingURL=route-settings.chunk.46192.js.map