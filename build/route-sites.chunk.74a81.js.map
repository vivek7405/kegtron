{"version":3,"sources":["webpack:///./global-access.js","webpack:///./routes/sites/index.js","webpack:///./routes/sites/style.css","webpack:///./configuration.js"],"names":["axios","require","default","GlobalAccess","getDevices","app","get","Configuration","mdashURL","localStorage","ktok","then","res","devices","pending","Object","keys","data","pubkeys","map","k","url","encodeURIComponent","method","catch","Promise","all","setState","getAllServings","servings","Sites","props","kegLevel","keg","volSize","volStart","volDisp","toFixed","componentDidMount","this","headerName","backlink","state","length","constructor","render","table","sites","c","shadow","reported","config","name","siteName","defaultSiteName","kegs","low","empty","portCount","i","level","emptyThreshold","lowThreshold","class","values","sort","a","b","scope","v","h","href","style","Component","module","exports","baseURL","provisionURL","appID","callTimeoutMilli","drinkSizes","drinkSizes_US","kegSizes","kegSizes_US"],"mappings":"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","file":"route-sites.chunk.74a81.js","sourcesContent":["import Configuration from './configuration';\r\nconst axios = require('axios').default;\r\n\r\nexport default class GlobalAccess {\r\n    static getDevices = (app) => {\r\n        axios\r\n            .get(\r\n                Configuration.mdashURL + \"/customer?access_token=\" + localStorage.ktok\r\n            )\r\n            .then(function (res) {\r\n                var devices = {},\r\n                    pubkeys = res.data.pubkeys || {};\r\n                var keys = Object.keys(pubkeys);\r\n                var pending = keys.map(function (k) {\r\n                    var url =\r\n                        Configuration.mdashURL +\r\n                        \"/api/v2/m/device?access_token=\" +\r\n                        encodeURIComponent(k);\r\n                    return axios({\r\n                        method: \"GET\",\r\n                        url: url\r\n                    })\r\n                        .then(function (res) {\r\n                            devices[k] = res.data;\r\n                        })\r\n                        .catch(function () { });\r\n                });\r\n                Promise.all(pending).then(function () {\r\n                    app.setState({\r\n                        devices: devices\r\n                    });\r\n                })\r\n            });\r\n    }\r\n\r\n    static getAllServings = (app) => {\r\n        axios\r\n            .get(\r\n                Configuration.mdashURL + \"/customer?access_token=\" + localStorage.ktok\r\n            )\r\n            .then(function (res) {\r\n                var servings = {}, pubkeys = res.data.pubkeys || {};\r\n\r\n                var keys = Object.keys(pubkeys);\r\n                var pending = keys.map(function (k) {\r\n                    var url = Configuration.mdashURL + \"/api/v2/m/device/data/servings_all?access_token=\" + encodeURIComponent(k);\r\n                    return axios({\r\n                        method: \"GET\",\r\n                        url: url\r\n                    })\r\n                        .then(function (res) {\r\n                            servings[k] = res.data;\r\n                        })\r\n                        .catch(function () { });\r\n                });\r\n                Promise.all(pending).then(function () {\r\n                    app.setState({\r\n                        servings: servings,\r\n                        pubkeys: pubkeys\r\n                    });\r\n                })\r\n            });\r\n    }\r\n}","import { h, Component } from 'preact';\r\nimport Router from 'preact-router';\r\nimport style from './style';\r\nimport Configuration from '../../configuration';\r\nimport GlobalAccess from '../../global-access';\r\n\r\nexport default class Sites extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n    }\r\n\r\n    componentDidMount() {\r\n        let self = this;        \r\n\r\n        self.props.app.setState({\r\n            headerName: \"Sites\",\r\n            backlink: \"\"\r\n        });\r\n\r\n        if (self.props.app.state.devices) {\r\n            if (Object.keys(self.props.app.state.devices).length === 0 && self.props.app.state.devices.constructor === Object) {\r\n                GlobalAccess.getDevices(self.props.app);\r\n            }\r\n        }\r\n    }\r\n\r\n    kegLevel = (keg) => {\r\n        return keg.volSize ?\r\n            +((100 * (keg.volStart - keg.volDisp)) / keg.volSize).toFixed(2) :\r\n            0;\r\n    }\r\n\r\n    render() {\r\n        let self = this;\r\n        let sites = {};\r\n\r\n        for (let k in self.props.app.state.devices) {\r\n            let d = self.props.app.state.devices[k],\r\n                c = d.shadow.state.reported.config,\r\n                name = c.siteName || Configuration.defaultSiteName;\r\n            if (!sites[name]) sites[name] = {\r\n                name: name,\r\n                kegs: 0,\r\n                low: 0,\r\n                empty: 0\r\n            };\r\n            sites[name].kegs += c.portCount || 0;\r\n            for (let i = 0; i < c.portCount; i++) {\r\n                let keg = c[\"port\" + i];\r\n                if (!keg) continue;\r\n                let level = self.kegLevel(keg);\r\n                if (level < c.emptyThreshold) {\r\n                    sites[name].empty++;\r\n                } else if (level < c.lowThreshold) {\r\n                    sites[name].low++;\r\n                }\r\n            }\r\n        }\r\n\r\n        let table;\r\n\r\n        if (Object.keys(sites).length == 0) {\r\n            table = <div class=\"overflow-auto p-2\">\r\n                <div class=\"h-100 d-flex align-items-center\">\r\n                    <div class=\"text-center w-100 text-muted font-weight-light\">\r\n                        <i class=\"fa fa-home fa-3x\"></i>\r\n                        <br />\r\n                        No Sites\r\n                    </div>\r\n                </div>\r\n            </div>;\r\n        } else {\r\n            sites = Object.values(sites);\r\n            sites.sort(function (a, b) {\r\n                return a.name > b.name ? 1 : -1;\r\n            });\r\n\r\n            table = <div class=\"overflow-auto p-2\">\r\n                <table class=\"w-100 table table-borderless table-sm\">\r\n                    <tr class=\"small border-bottom text-center\">\r\n                        <th scope=\"col\" class=\"text-left\">\r\n                            Site\r\n                            </th>\r\n                        <th scope=\"col\">\r\n                            Kegs\r\n                            </th>\r\n                        <th scope=\"col\">\r\n                            Low\r\n                            </th>\r\n                        <th scope=\"col\">\r\n                            Empty\r\n                            </th>\r\n                    </tr>\r\n\r\n                    {sites.map(function (v) {\r\n                        return h(\r\n                            \"tr\", {\r\n                            class: \"text-center\"\r\n                        },\r\n                            <td class=\"text-left\">\r\n                                <a href={\"/sites/\" + v.name}>{v.name}</a>\r\n                            </td>,\r\n                            <td style=\"width: 25%\">\r\n                                {v.kegs}\r\n                            </td>,\r\n                            <td style=\"width: 25%\" class={v.low <= 0 ? \"\" : \"bg-warning\"}>\r\n                                {v.low}\r\n                            </td>,\r\n                            <td style=\"width: 25%\" class={v.empty <= 0 ? \"\" : \"bg-danger\"}>\r\n                                {v.empty}\r\n                            </td>\r\n                        );\r\n                    })}\r\n                </table>\r\n            </div>;\r\n        }\r\n\r\n        return (\r\n            <div class={style.sites}>\r\n                {table}\r\n            </div>\r\n        );\r\n    };\r\n}\r\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"sites\":\"sites__1tU4b\"};","const Configuration = {\r\n    baseURL: \"http://localhost:8080/\",\r\n    provisionURL: \"http://192.168.4.1\",\r\n    mdashURL: \"https://mdash.net\",\r\n    appID: \"\", // <-- Set this to YOUR_APP_ID\r\n    callTimeoutMilli: 10000, // 10 seconds\r\n    defaultSiteName: \"NewSite\",\r\n    drinkSizes: {\r\n        \"1000\": \"Liter (1000 mL)\",\r\n        \"500\": \"Half Liter (500 mL)\",\r\n        \"651\": \"Bomber (651 mL)\",\r\n        \"568\": \"UK Pint (568 mL)\",\r\n        \"473\": \"US Pint (473 mL)\",\r\n        \"355\": \"US Bottle (355 mL)\",\r\n        \"0\": \"Custom\"\r\n    },\r\n    drinkSizes_US: {\r\n        \"1000\": \"Liter (33.8oz)\",\r\n        \"500\": \"Half Liter (16.9 oz)\",\r\n        \"651\": \"Bomber (22.0 oz)\",\r\n        \"568\": \"UK Pint (19.2 oz)\",\r\n        \"473\": \"US Pint (16 oz)\",\r\n        \"355\": \"US Bottle (12 oz)\",\r\n        \"0\": \"Custom\"\r\n    },\r\n    kegSizes: {\r\n        \"9464\": \"Half Corny (9.5L)\",\r\n        \"18927\": \"Corny (18.9L)\",\r\n        \"19550\": \"1/6 Barrel (19.6L)\",\r\n        \"20000\": \"20L\",\r\n        \"25000\": \"25L\",\r\n        \"29340\": \"1/4 Barrel (29.3L)\",\r\n        \"30000\": \"30L\",\r\n        \"40915\": \"Firkin (40.9L)\",\r\n        \"50000\": \"50L\",\r\n        \"58670\": \"1/2 Barrel (58.7L)\",\r\n        \"0\": \"Custom\"\r\n    },\r\n    kegSizes_US: {\r\n        \"9464\": \"Half Corny (2.5 gal)\",\r\n        \"18927\": \"Corny (5 gal)\",\r\n        \"19550\": \"1/6 Barrel (5.16 gal)\",\r\n        \"20000\": \"20L (5.28 gal)\",\r\n        \"25000\": \"25L (6.6 gal)\",\r\n        \"29340\": \"1/4 Barrel (7.75 gal)\",\r\n        \"30000\": \"30L (7.93 gal)\",\r\n        \"40915\": \"Firkin (10.81 gal)\",\r\n        \"50000\": \"50L (13.21 gal)\",\r\n        \"58670\": \"1/2 Barrel (15.5 gal)\",\r\n        \"0\": \"Custom\"\r\n    }\r\n}\r\n\r\nexport default Configuration;"],"sourceRoot":""}