(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{Hijf:function(){},XETS:function(t){t.exports={keg:"keg__TxwXi"}},hul5:function(t,e,n){"use strict";function r(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function a(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}n.r(e);var s=n("hosL"),o=(n("Y3FI"),n("XETS"),n("jmCe")),i=n("IMbM"),l=(n("Hijf"),n("TiKg")),c=n.n(l),h=(n("czhI"),function(t){function e(e){var n;return(n=t.call(this,e)||this).ref=function(t){var e=r(n);setTimeout((function(){t&&t.clientWidth&&0!=t.clientWidth&&e.setState({width:t.clientWidth})}),1)},n.getRows=function(){return n.props.data.reverse().map((function(t){return{x:t.timestamp,y:t.level,vol:t.vol}}))},n.getMaxX=function(t){var e=Math.max.apply(null,t.map((function(t){return t.x})));return e>0&&(e=c()(e).add(1,"hour").startOf("hour")),e},n.getMaxY=function(t){return Math.max.apply(null,t.map((function(t){return t.y||0})))},n.getMinX=function(t){var e=Math.min.apply(null,t.map((function(t){return t.x})));return e>0&&(e=c()(e).startOf("hour")),e},n.getGridLabelsPointsArr=function(t,e,a,o,i,l,h,d,u,p){for(var b=r(n),f=[],m=[],v=0;v<=l;v++){var j=v*(d-u-p)/l;f.push(["M",0,j+p].join(" ")),f.push(["L",h,j+p].join(" ")),0!=t.length&&(v<l&&m.push(Object(s.h)("text",{x:2,y:j+p+9,class:"label"},(l-v)*i/l)))}for(var g=0;g<o;g++){var O=g*h/o;if(f.push(["M",O,0].join(" ")),f.push(["L",O,d-u].join(" ")),0!=t.length){var x=c()(e+(a-e)*g/o);m.push(Object(s.h)("text",{x:O+2,y:d-12,class:"label"},x.format("YYYY-DD-MM"))),m.push(Object(s.h)("text",{x:O+2,y:d-2,class:"label"},x.format("hh:mm:ss")))}}return[f,m,t.map((function(t){return["L",b.mkx(t.x,h,a,e),b.mky(t.y,d,i,u,p)].join(" ")}))]},n.mkx=function(t,e,n,r){return parseInt(e*(t-r)/(n-r)||0)},n.mky=function(t,e,n,r,a){return parseInt((e-r-a)*(1-t/(n||1))||0)+a},n.getServings=function(t,e,a,s,o){var i=r(n),l=Math.max.apply(null,t.map((function(t){return t.vol||0})));return t.map((function(t){var n=i.mkx(t.x,s,e,a),r=(o*(t.vol||1)/(l||1)).toFixed(0);return["M",n,o,"L",n,o-r].join(" ")}))},n.state={width:400},n}var n,a;return a=t,(n=e).prototype=Object.create(a.prototype),n.prototype.constructor=n,n.__proto__=a,e.prototype.render=function(){var t=280,e=5,n=this.state.width,r=this.getRows(),a=this.getMaxX(r),o=this.getMinX(r);if(c.a.duration(a-o).asHours()<2)e=6;else for(;c.a.duration(a-o).asHours()%e>0;)o=o.add(-1,"hour");var i=this.getGridLabelsPointsArr(r,o,a,e,100,5,n,t,25,120),l=i[0],h=i[1],d=i[2],u=r[0]?["M",this.mkx(r[0].x,n,a,o),this.mky(r[0].y,t,100,25,120)].join(" "):"M 0 0",p=this.getServings(r,a,o,n,120);return Object(s.h)("div",{class:"w-100",style:"height: 280px",ref:this.ref},Object(s.h)("svg",{fill:"none",class:"h-100 w-100"},Object(s.h)("style",{},".label {fill: #777; font: italic 10px sans-serif;}.title {fill: #555; font: bold 14px sans-serif;}"),h,Object(s.h)("path",{d:"M 0 120 L 0 0 L "+n+" 0",stroke:"#ccc"}),Object(s.h)("rect",{x:"0",y:120,width:n,height:135,fill:"#fafafa"}),Object(s.h)("text",{x:"30",y:"20",stroke:"#aaa"},"Serving History"),Object(s.h)("text",{x:"30",y:140,stroke:"#aaa"},"Volume History"),Object(s.h)("path",{d:p.join(" "),stroke:"blue","stroke-width":"7"}),Object(s.h)("path",{d:l.join(" "),stroke:"#ccc","stroke-width":"0.5"}),Object(s.h)("path",{d:u+d.join(" "),stroke:"#3cc","stroke-width":"2"})))},e}(s.Component));n.d(e,"default",(function(){return u}));var d=n("czhI").default,u=function(t){function e(e){var n;return(n=t.call(this,e)||this).componentDidMount=function(){var t=a(n);t.props.app.state.devices&&0===Object.keys(t.props.app.state.devices).length&&t.props.app.state.devices.constructor===Object&&i.a.getDevices(t.props.app),t.props.app.setState({headerName:"Sites / "+t.props.name+" / "+t.props.id+" / "+(+t.props.port+1),backlink:"/sites/"+t.props.name}),t.setState({end:"now",start:c()().add(-5,"days").format("YYYY-MM-DD HH:MM")})},n.componentWillReceiveProps=function(t){var e=a(n),r=e.getDevicePubkeyById(t.app,t.id);if(r){if(!e.ws){var s=o.a.mdashURL.replace(/^http/,"ws")+"/api/v2/m/device/notify?access_token="+r;e.ws=e.websocket(s),e.ws.onmessage=function(){i.a.getDevices(e.props.app)}}e.setState({pubkey:r,d:t.app.state.devices[r],data:[]}),e.getServingHistory(r)}},n.componentWillUnmount=function(){var t=a(n);t.ws&&t.ws.close()},n.getDevicePubkeyById=function(t,e){for(var n in t.state.devices){if(t.state.devices[n].id==e)return n}return null},n.getServingHistory=function(t){var e=a(n);return d.get(o.a.mdashURL+"/api/v2/m/device/data/servings?access_token="+t).then((function(t){for(var n=[],r=0;r<t.data.rows.length;r++){var a=JSON.parse(t.data.rows[r][3]);a.port==e.props.port&&(a.timestamp=c.a.utc(t.data.rows[r][0]).local(),n.push(a))}e.setState({data:n})}))},n.websocket=function(t){var e={shouldReconnect:!0,close:function(){e.shouldReconnect=!1,e.ws.close()}};return function n(){var r,a=new WebSocket(t);a.onmessage=function(t){try{r=JSON.parse(t.data)}catch(e){console.log("Invalid ws frame:",t.data)}r&&e.onmessage(r)},a.onclose=function(){window.clearTimeout(e.tid),e.shouldReconnect&&(e.tid=window.setTimeout(n,1e3))},e.ws=a}(),e},n.mlToUnits=function(t,e){return e.displayUnits?+t+" mL":(.033814*+t).toFixed(1)+" oz"},n.mlToUnits2=function(t,e){return e.displayUnits?(t/1e3).toFixed(2)+" L":(t/3785.41).toFixed(2)+" gal"},n.getFilteredData=function(){var t=a(n),e=c()(t.state.start,"YYYY-MM-DDThh:mm"),r="now"==t.state.end?c()().local():t.state.end;return(n.state.data||[]).filter((function(t){return t.timestamp.isAfter(c()(e))&&t.timestamp.isBefore(c()(r))}))},n.getEventsTable=function(t,e){var r=a(n),o=e.config||{};return Object(s.h)("div",{class:"table-responsive",style:"max-height: 15em"},Object(s.h)("table",{class:"table table-sm table-borderless small text-nowrap"},Object(s.h)("tr",null,Object(s.h)("th",null,"Timestamp"),Object(s.h)("th",null,"Serving Size"),Object(s.h)("th",null,"Level")),t.map((function(t){return Object(s.h)("tr",{},Object(s.h)("td",null,t.timestamp.format("YYYY-MM-DD HH:mm")),Object(s.h)("td",null,r.mlToUnits(t.vol,o)),Object(s.h)("td",null,(t.level||0).toFixed(1),"%"))}))))},n.getInfoTable=function(t,e,r){var o=a(n),i=e.config||{},l=i.displayUnits,h=l?i.temp.toFixed(1):(9*i.temp/5+32).toFixed(1),d=l?"℃":"℉";return Object(s.h)("div",{class:"table-responsive"},Object(s.h)("table",{class:"table table-sm table-borderless small"},Object(s.h)("tr",null,Object(s.h)("td",null,"Description"),Object(s.h)("th",{class:"text-right"},t.userDesc)),Object(s.h)("tr",null,Object(s.h)("td",null,"Status"),Object(s.h)("th",{class:"text-right "+(e.online?"text-success":"text-danger")},e.online?"online":"offline")),Object(s.h)("tr",null,Object(s.h)("td",null,"Temperature"),Object(s.h)("th",{class:"text-right"},h,d)),Object(s.h)("tr",null,Object(s.h)("td",null,"Humidity"),Object(s.h)("th",{class:"text-right"},(1*i.humidity).toFixed(1),"%")),Object(s.h)("tr",null,Object(s.h)("td",null,"Model"),Object(s.h)("th",{class:"text-right"},i.modelNum)),Object(s.h)("tr",null,Object(s.h)("td",null,"Port"),Object(s.h)("th",{class:"text-right"},parseInt(o.props.port)+1)),Object(s.h)("tr",null,Object(s.h)("td",null,"Keg Size"),Object(s.h)("th",{class:"text-right"},o.mlToUnits2(t.volSize,i))),Object(s.h)("tr",null,Object(s.h)("td",null,"Starting Volume"),Object(s.h)("th",{class:"text-right"},o.mlToUnits2(t.volStart,i))),Object(s.h)("tr",null,Object(s.h)("td",null,"Last Cleaned"),Object(s.h)("th",{class:"text-right"},t.dateCleaned?c()(t.dateCleaned).fromNow():"-")),Object(s.h)("tr",null,Object(s.h)("td",null,"Days on Tap"),Object(s.h)("th",{class:"text-right"},t.dateTapped?c()(t.dateTapped||void 0).fromNow().replace(" ago",""):"-")),Object(s.h)("tr",null,Object(s.h)("td",null,"Kegs Served"),Object(s.h)("th",{class:"text-right"},t.kegsServed||0)),Object(s.h)("tr",null,Object(s.h)("td",null,"Volume Served"),Object(s.h)("th",{class:"text-right"},o.mlToUnits2(t.volDisp,i))),Object(s.h)("tr",null,Object(s.h)("td",null,"Last Served"),Object(s.h)("th",{class:"text-right"},0==r.length?"-":o.mlToUnits(r[0].vol,i)))))},n.getInfoDiv=function(t){var e=120,n=240,r=t.volStart-t.volDisp||0;t.volSize&&(r/=t.volSize);var a=220*(r<0?0:r),o=parseInt((100*r).toFixed(0));return Object(s.h)("div",{class:"float-left mr-5",style:"margin: auto"},Object(s.h)("svg",{class:"mr-2 bg-light",width:e,height:n},Object(s.h)("rect",{fill:"#333",x:"0",y:"0",width:e,height:n,rx:12}),Object(s.h)("rect",{fill:"#79f",x:"10",y:n-a-10,width:100,height:a}),Object(s.h)("text",{textAnchor:"middle",x:o<10?"35%":100===o?"16%":"25%",y:120,fill:"#ff0",style:"font-weight: bold; font-size: 200%"},o,"%")))},n.getGraphToolBar=function(){var t=a(n),e=String(t.state.start).includes("T")?t.state.start:c()(t.state.start).format("YYYY-MM-DDThh:mm"),r="now"==t.state.end?c()().format("YYYY-MM-DDThh:mm"):String(t.state.end).includes("T")?t.state.end:c()(t.state.end).format("YYYY-MM-DDThh:mm");return Object(s.h)("div",{class:"form-inline"},Object(s.h)("span",{class:"mr-5"},"Graph"),Object(s.h)("label",{class:"mr-2 small"},"Start:"),Object(s.h)("input",{class:"form-control form-control-sm",type:"datetime-local",value:e,onChange:function(e){t.setState({start:e.target.value})}}),Object(s.h)("label",{class:"mx-2 small"},"End:"),Object(s.h)("input",{class:"form-control form-control-sm",type:"datetime-local",value:r,onChange:function(e){t.setState({end:e.target.value})}}))},n.state={},n}var n,r;return r=t,(n=e).prototype=Object.create(r.prototype),n.prototype.constructor=n,n.__proto__=r,e.prototype.render=function(){var t=(((this.state.d||{}).shadow||{}).state||{}).reported||{},e=(t.config||{})["port"+this.props.port]||{},n=this.getFilteredData();return Object(s.h)("div",{class:"overflow-auto p-2"},Object(s.h)("div",{class:"font-weight-light card-deck"},Object(s.h)("div",{class:"card my-2"},Object(s.h)("div",{class:"card-header font-weight-bold"},"Port "+(+this.props.port+1)+": "+(e.userName||"")),Object(s.h)("div",{class:"card-body d-flex"},this.getInfoDiv(e),this.getInfoTable(e,t,n))),Object(s.h)("div",{class:"card my-2"},Object(s.h)("div",{class:"card-header font-weight-bold"},"Serving History"),Object(s.h)("div",{class:"card-body"},this.getEventsTable(n,t)))),Object(s.h)("div",{class:"font-weight-light card-deck"},Object(s.h)("div",{class:"card my-2"},Object(s.h)("div",{class:"card-header font-weight-bold"},this.getGraphToolBar()),Object(s.h)("div",{class:"card-body table-responsive"},Object(s.h)(h,{data:n})))))},e}(s.Component)}}]);
//# sourceMappingURL=route-keg.chunk.1f283.js.map