(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{"3Om4":function(t){t.exports={addDevice:"addDevice__3BlMH"}},AY3n:function(t,e,n){"use strict";function i(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}n.r(e),n.d(e,"default",(function(){return u}));var o=n("hosL"),a=(n("Y3FI"),n("3Om4")),r=n.n(a),s=n("jmCe"),c=n("eWb4"),l=n("czhI").default,u=function(t){function e(e){var n;return(n=t.call(this,e)||this).unmounted=!1,n.scan=function(){var t=i(n);return new Promise((function(e,n){var i=0;!function o(){l({url:s.a.provisionURL+"/GetKey",timeout:s.a.callTimeoutMilli}).then((function(i){var o=i.data.result;o?(t.setState({step:1,public_key:o}),e()):n(i.data.error)}),(function(){t.unmounted||setTimeout(o,500)})),i++,console.log("attempt",i)}()}))},n.onSSIDInput=function(t){n.setState({ssid:t.target.value})},n.onPasswordInput=function(t){n.setState({pass:t.target.value})},n.configureDeviceWifi=function(){var t=i(n),e=JSON.stringify({ssid:t.state.ssid,pass:t.state.pass});return l({method:"POST",url:s.a.provisionURL+"/setup",timeout:s.a.callTimeoutMilli,data:e}).then((function(e){e.data.result?t.setState({step:2}):alert("Error: "+e.data.error)}))},n.registerDevice=function(){var t=i(n),e=s.a.mdashURL+"/customer?access_token="+localStorage.ktok;return l.get(e).then((function(n){var i=n.data;return i.pubkeys||(i.pubkeys={}),i.pubkeys[t.state.public_key]={},l({method:"POST",url:e,data:i})})).then((function(){location.href="https://"+location.host+location.pathname})).catch((function(t){alert("Error registering device ("+t+"). Join your WiFi network and retry.")}))},n.backToStep0=function(){n.setState({step:0})},n.backToStep1=function(){n.setState({step:1})},n.state={step:0,ssid:"",pass:"",public_key:""},n}var n,a;a=t,(n=e).prototype=Object.create(a.prototype),n.prototype.constructor=n,n.__proto__=a;var u=e.prototype;return u.componentDidMount=function(){this.props.app.setState({headerName:"Add Device",backlink:""})},u.componentWillUnmount=function(){this.unmounted=!0},u.render=function(){var t;return t=0===this.state.step?Object(o.h)("div",null,Object(o.h)("div",{class:"p-2 text-muted font-weight-light lead"},"Go to your phone settings",Object(o.h)("br",null),"Join WiFi network Kegtron-XXXX",Object(o.h)("br",null),"Return to this screen and press the Scan button"),Object(o.h)(c.a,{class:"btn-block btn-primary border font-weight-light",title:"Scan",icon:"fa-search",onClick:this.scan})):1===this.state.step?Object(o.h)("div",null,Object(o.h)("a",{href:location.href,class:"link text-decoration-none",onClick:this.backToStep0},Object(o.h)("span",{class:"fa fa-arrow-left"}),"back"),Object(o.h)("div",{class:"p-2 text-muted font-weight-light lead mt-2"},"Found new device"),Object(o.h)("input",{class:"form-control mb-2",type:"text",placeholder:"WiFi network name",onInput:this.onSSIDInput}),Object(o.h)("input",{class:"form-control mb-2",type:"text",placeholder:"WiFi password",onInput:this.onPasswordInput}),Object(o.h)(c.a,{class:"btn-block btn-primary font-weight-light",title:"Configure device WiFi",icon:"fa-save",disabled:!this.state.ssid,onClick:this.configureDeviceWifi})):2===this.state.step?Object(o.h)("div",null,Object(o.h)("a",{href:location.href,class:"link text-decoration-none",onClick:this.backToStep1},Object(o.h)("span",{class:"fa fa-arrow-left"}),"back"),Object(o.h)("div",{class:"p-2 text-muted font-weight-light lead mt-2"},"WiFi settings applied. Go to your phone settings,",Object(o.h)("br",null),"Join back to your WiFi network,",Object(o.h)("br",null),"Return to this screen and click on Register Device."),Object(o.h)("input",{class:"form-control mb-2",type:"text",placeholder:"WiFi network name",onInput:this.onSSIDInput}),Object(o.h)("input",{class:"form-control mb-2",type:"text",placeholder:"WiFi password",onInput:this.onPasswordInput}),Object(o.h)(c.a,{class:"btn-block btn-primary border font-weight-light",title:"Register Device",icon:"fa-plus-circle",onClick:this.registerDevice})):Object(o.h)("div",null),Object(o.h)("div",{class:r.a.addDevice},Object(o.h)("div",{class:"overflow-auto p-2"},t))},e}(o.Component)},jmCe:function(t,e){"use strict";e.a={baseURL:"http://localhost:8080/",provisionURL:"http://192.168.4.1",mdashURL:"https://mdash.net",appID:"",callTimeoutMilli:1e4,defaultSiteName:"NewSite",drinkSizes:{1e3:"Liter (1000 mL)",500:"Half Liter (500 mL)",651:"Bomber (651 mL)",568:"UK Pint (568 mL)",473:"US Pint (473 mL)",355:"US Bottle (355 mL)",0:"Custom"},drinkSizes_US:{1e3:"Liter (33.8oz)",500:"Half Liter (16.9 oz)",651:"Bomber (22.0 oz)",568:"UK Pint (19.2 oz)",473:"US Pint (16 oz)",355:"US Bottle (12 oz)",0:"Custom"},kegSizes:{9464:"Half Corny (9.5L)",18927:"Corny (18.9L)",19550:"1/6 Barrel (19.6L)",2e4:"20L",25e3:"25L",29340:"1/4 Barrel (29.3L)",3e4:"30L",40915:"Firkin (40.9L)",5e4:"50L",58670:"1/2 Barrel (58.7L)",0:"Custom"},kegSizes_US:{9464:"Half Corny (2.5 gal)",18927:"Corny (5 gal)",19550:"1/6 Barrel (5.16 gal)",2e4:"20L (5.28 gal)",25e3:"25L (6.6 gal)",29340:"1/4 Barrel (7.75 gal)",3e4:"30L (7.93 gal)",40915:"Firkin (10.81 gal)",5e4:"50L (13.21 gal)",58670:"1/2 Barrel (15.5 gal)",0:"Custom"}}}}]);
//# sourceMappingURL=route-add-device.chunk.7a633.js.map