(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{"5znX":function(e){e.exports={settings:"settings__1JFwH",portConfig:"portConfig__2M7mG"}},IMbM:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var a=s("jmCe"),o=s("czhI").default;class r{}r.getDevices=e=>{o.get(a.a.mdashURL+"/customer?access_token="+localStorage.ktok).then((function(t){var s={},r=Object.keys(t.data.pubkeys||{}).map((function(e){var t=a.a.mdashURL+"/api/v2/m/device?access_token="+encodeURIComponent(e);return o({method:"GET",url:t}).then((function(t){s[e]=t.data})).catch((function(){}))}));Promise.all(r).then((function(){e.setState({devices:s})}))}))},r.getAllServings=e=>{o.get(a.a.mdashURL+"/customer?access_token="+localStorage.ktok).then((function(t){var s={},r=t.data.pubkeys||{},i=Object.keys(r).map((function(e){var t=a.a.mdashURL+"/api/v2/m/device/data/servings_all?access_token="+encodeURIComponent(e);return o({method:"GET",url:t}).then((function(t){s[e]=t.data})).catch((function(){}))}));Promise.all(i).then((function(){e.setState({servings:s,pubkeys:r})}))}))}},Y72v:function(){},jmCe:function(e,t){"use strict";t.a={baseURL:"http://localhost:8080/",provisionURL:"http://192.168.4.1",mdashURL:"https://mdash.net",appID:"",callTimeoutMilli:1e4,defaultSiteName:"NewSite",drinkSizes:{1e3:"Liter (1000 mL)",500:"Half Liter (500 mL)",651:"Bomber (651 mL)",568:"UK Pint (568 mL)",473:"US Pint (473 mL)",355:"US Bottle (355 mL)",0:"Custom"},drinkSizes_US:{1e3:"Liter (33.8oz)",500:"Half Liter (16.9 oz)",651:"Bomber (22.0 oz)",568:"UK Pint (19.2 oz)",473:"US Pint (16 oz)",355:"US Bottle (12 oz)",0:"Custom"},kegSizes:{9464:"Half Corny (9.5L)",18927:"Corny (18.9L)",19550:"1/6 Barrel (19.6L)",2e4:"20L",25e3:"25L",29340:"1/4 Barrel (29.3L)",3e4:"30L",40915:"Firkin (40.9L)",5e4:"50L",58670:"1/2 Barrel (58.7L)",0:"Custom"},kegSizes_US:{9464:"Half Corny (2.5 gal)",18927:"Corny (5 gal)",19550:"1/6 Barrel (5.16 gal)",2e4:"20L (5.28 gal)",25e3:"25L (6.6 gal)",29340:"1/4 Barrel (7.75 gal)",3e4:"30L (7.93 gal)",40915:"Firkin (10.81 gal)",5e4:"50L (13.21 gal)",58670:"1/2 Barrel (15.5 gal)",0:"Custom"}}},qFzw:function(){},yUQ5:function(){},yzNr:function(e,t,s){"use strict";function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e}).apply(this,arguments)}function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e}).apply(this,arguments)}function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e}).apply(this,arguments)}s.r(t);var i=s("hosL"),n=s("Y3FI"),l=s("5znX"),h=s.n(l),c=s("jmCe"),u=s("eWb4");s("Y72v");class p extends i.Component{constructor(e){super(e),this.stringToString=e=>e,this.componentDidMount=()=>{this.normalize=this.props.normalize||this.stringToString,this.format=this.props.format||this.stringToString,this.setState({value:this.normalize(this.props.value)})},this.componentWillReceiveProps=e=>{this.normalize=e.normalize||this.stringToString,this.format=e.format||this.stringToString,this.props.value!==e.value&&this.setState({value:this.normalize(e.value)})},this.handleInput=e=>{this.setState({value:e.target.value}),this.props.onInput(this.format(e.target.value))},this.state={}}render(){return Object(i.h)("input",a({},this.props,{type:this.props.type||"text",value:this.state.value,onInput:this.handleInput}))}}s("qFzw");class d extends i.Component{constructor(e){super(e),this.componentDidMount=()=>{this.props.extraProps=this.props.extraProps||{},this.setState({value:this.props.valueResolver(this.props.k,this.props.extraProps.type)})},this.componentWillReceiveProps=()=>{this.props.extraProps=this.props.extraProps||{};var e=this.props.valueResolver(this.props.k,this.props.extraProps.type);e!==this.state.value&&this.setState({value:e})},this.state={}}render(){var e=this;return Object(i.h)("div",{class:"form-group row my-2"},Object(i.h)("label",{class:"col-form-label col-4"},e.props.label),Object(i.h)("div",{class:e.props.badge?"col-3":"col-8"},Object(i.h)(p,o({},e.props.extraProps,{value:e.state.value,placeholder:e.props.label,class:"form-control",onInput:function(t){if(e.props.onChange("c."+e.props.k,t),e.props.k.match(/.volSize$/)){var s=e.props.k.replace(".volSize",".volStart");e.props.onChange("c."+s,t)}}}))),e.props.badge?Object(i.h)("div",{class:"col-1 d-flex align-items-center"},e.props.badge):null)}}s("yUQ5");class v extends i.Component{constructor(e){super(e),this.closeModal=()=>{self.props.onClose()},this.state={}}render(){var e;return e=this.props.open?Object(i.h)(Modal,{open:"true"},Object(i.h)("div",{class:"modal-dialog",role:"document"},Object(i.h)("div",{class:"modal-header"},Object(i.h)("h5",{class:"modal-title",id:"exampleModalLabel"},"Alert")),Object(i.h)("div",{class:"modal-body"},Object(i.h)("p",{class:"lead"},this.props.children)),Object(i.h)("div",{class:"modal-footer"},Object(i.h)("button",{type:"button",class:"btn btn-primary mx-auto btn-lg",onClick:this.closeModal},"OK")))):"",Object(i.h)("div",null,e)}}var m=s("IMbM");s.d(t,"default",(function(){return b}));var g=s("czhI").default;class b extends i.Component{constructor(e){super(e),this.recursive=(e,t,s)=>{var a=t.splice(0,1)[0];return"object"!=typeof e?s:r({},e,{[a]:this.recursive(e[a],t)})},this.setNestedState=(e,t,s)=>{var a=this,o=t.split(".");e(e=>{a.recursive(e,o,s)})},this.setKey=(e,t,s)=>{isNaN(s)||(s=Number(s));for(var a=t.split("."),o=0;o<a.length;o++)o>=a.length-1?e[a[o]]=s:(e[a[o]]||(e[a[o]]={}),e=e[a[o]])},this.getKey=(e,t)=>{for(var s=t.split("."),a=0;a<s.length;a++){if(!(s[a]in e))return;e=e[s[a]]}return e},this.handleMkRowChange=(e,t)=>{this.setNestedState.bind(null,this.setState.bind(this))(e,t),this.setKey(this.state,e,t)},this.mkRowValueResolver=(e,t)=>{var s=this.state.d.shadow.state.reported,a=this.getKey(this.state.c,e);return void 0===a&&(a=this.getKey(s.config,e)),a="date"===t?a.replace(/\//g,"-"):a},this.onAutoKegReset=e=>{this.setState({autoKegResetAlertOpen:1==e})},this.closeAutoKegResetModal=()=>{this.setState({autoKegResetAlertOpen:!1})},this.closeAutoKegResetModal=()=>{this.setState({autoKegResetAlertOpen:!1})},this.getDevicePubkeyById=(e,t)=>{for(var s in e.state.devices){if(e.state.devices[s].id==t)return s}return null},this.drinkSizeIsCustom=(e,t)=>0==t||e.every((function(e){return String(e.value)!==String(t)})),this.kegSizeIsCustom=(e,t)=>0==t||e.every((function(e){return String(e.value)!==String(t)})),this.mkDropdownRow=(e,t,s,a)=>{var o=this,r=o.state.d.shadow.state.reported,n=o.isDisplayUnitMetric()?c.a.kegSizes:c.a.kegSizes_US,l=o.getKey(o.state.c,t);return void 0===l&&(l=o.getKey(r.config,t)),t.match(/volSize$/)?(l=Number(l))in n||(l=0):!t.match(/drinkSize$/)||l in c.a.drinkSizes||(l=0),Object(i.h)("div",{class:"form-group row my-2"},Object(i.h)("label",{class:"col-form-label col-4"},e),Object(i.h)("div",{class:"col-8"},Object(i.h)("select",{class:"form-control",type:"text",value:l,onChange:function(e){var s=e.target.value;o.setKey(o.state.c,t,s),a&&a(s),o.setState(o.state)}},s.map((function(e){return Object(i.h)("option",{value:e.value},e.title)})))))},this.litersToML=e=>1e3*e,this.mLToLiters=e=>e/1e3,this.ouncesToLiter=e=>Number((.0295735296875*e).toFixed(3)),this.literToOunces=e=>Number((e/.0295735296875).toFixed(3)),this.millilitersToGallons=e=>Number((.26417*e/1e3).toFixed(3)),this.gallonsToMilliliters=e=>Number((e/.26417*1e3).toFixed(3)),this.curry=(e,t,s)=>{var a=[e,t,s];return function(e){return a.reduce((function(e,t){return t(e)}),e)}},this.curry=(e,t)=>{var s=[e,t];return function(e){return s.reduce((function(e,t){return t(e)}),e)}},this.isDisplayUnitMetric=()=>0!==(void 0!==this.state.c.displayUnits?this.state.c.displayUnits:this.state.d.shadow.state.reported.config.displayUnits),this.getPortConfigs=()=>{var e=this,t=e.state.d.shadow.state.reported;t.config.chipID=((t.ota||{}).id||"").toUpperCase();var s=e.isDisplayUnitMetric(),a=c.a.drinkSizes,o=s?a:c.a.drinkSizes_US,r=Object.keys(o).map(e=>({value:Number(e),title:o[e]}));r=r.sort((function(e,t){return+e.value<+t.value?1:-1}));var n=c.a.kegSizes,l=s?n:c.a.kegSizes_US,p=Object.keys(l).map(e=>({value:Number(e),title:l[e]}));p.sort((function(e,t){return+e.value<+t.value?1:-1}));for(var v=[],b=a=>{var o="port"+a,n=o+".drinkSize",l=e.getKey(e.state.c,n);void 0===l&&(l=e.getKey(t.config,n));var b=o+".volSize",k=e.getKey(e.state.c,b);void 0===k&&(k=e.getKey(t.config,b));var f={format:s?Math.round.bind(Math):e.curry(e.litersToML,e.ouncesToLiter,Math.round.bind(Math)),normalize:s?Math.round.bind(Math):e.curry(e.mLToLiters,e.literToOunces,Math.round.bind(Math))},R={format:e.curry(s?e.litersToML:e.gallonsToMilliliters,Math.round.bind(Math)),normalize:e.curry(s?e.mLToLiters:e.millilitersToGallons,Math.round.bind(Math))};v.push(Object(i.h)("div",null,Object(i.h)("div",{class:h.a.portConfig},Object(i.h)("hr",null),"Port ",a+1),Object(i.h)(d,{onChange:e.handleMkRowChange,valueResolver:e.mkRowValueResolver,label:"Name",key:o+".userName",k:o+".userName"}),Object(i.h)(d,{onChange:e.handleMkRowChange,valueResolver:e.mkRowValueResolver,label:"Description",key:o+".userDesc",k:o+".userDesc"}),e.mkDropdownRow("Keg Size",o+".volSize",p,(function(t){e.setKey(e.state.c,o+".volStart",t),e.setKey(e.state.c,o+".isKegSizeCustom",0==t?1:0),e.setState(e.state)})),e.kegSizeIsCustom(p,void 0===e.getKey(e.state.c,o+".volSize")?e.getKey(t.config,o+".volSize"):e.getKey(e.state.c,o+".volSize"))?Object(i.h)(d,{onChange:e.handleMkRowChange,valueResolver:e.mkRowValueResolver,label:"",key:o+".volSize",k:o+".volSize",badge:s?"L":"gal",extraProps:R}):null,Object(i.h)(d,{onChange:e.handleMkRowChange,valueResolver:e.mkRowValueResolver,label:"Keg Volume Start "+(s?"(L)":"(gal)"),key:o+".volStart",k:o+".volStart",extraProps:R}),e.mkDropdownRow("Serving Size",o+".drinkSize",r,(function(t){e.setKey(e.state.c,o+".isDrinkSizeCustom",0==t?1:0),e.setState(e.state)})),e.drinkSizeIsCustom(r,void 0===e.getKey(e.state.c,o+".drinkSize")?e.getKey(t.config,o+".drinkSize"):e.getKey(e.state.c,o+".drinkSize"))?Object(i.h)(d,{onChange:e.handleMkRowChange,valueResolver:e.mkRowValueResolver,label:"",key:o+".drinkSize",k:o+".drinkSize",badge:s?"mL":"oz",extraProps:f}):null,Object(i.h)(d,{onChange:e.handleMkRowChange,valueResolver:e.mkRowValueResolver,label:"Cal. Offset %",key:o+".calOffset",k:o+".calOffset"}),Object(i.h)(d,{onChange:e.handleMkRowChange,valueResolver:e.mkRowValueResolver,label:"Date Tapped",key:o+".dateTapped",k:o+".dateTapped",extraProps:{type:"date"}}),Object(i.h)(d,{onChange:e.handleMkRowChange,valueResolver:e.mkRowValueResolver,label:"Date Cleaned",key:o+".dateCleaned",k:o+".dateCleaned",extraProps:{type:"date"}}),Object(i.h)("div",{class:"form-group row my-2"},Object(i.h)("label",{class:"col-form-label col-4"},"Volume Reset"),Object(i.h)("div",{class:"col-8"},Object(i.h)(u.a,{class:"btn-block btn-warning",icon:"fa-minus-square",title:"Reset Keg Volume",onClick:function(){if(confirm("Sure to reset this volume?")){var t=c.a.mdashURL+"/api/v2/m/device/rpc/Kegtron.ResetVolume?access_token="+encodeURIComponent(e.state.pubkey);return g({method:"POST",url:t,data:{port:a}}).then((function(){t=t.replace("/rpc/Kegtron.ResetVolume","");var e={};return e["port"+a]={dateCleaned:null,dateTapped:null},g({method:"POST",url:t,data:{shadow:{state:{desired:{config:e}}}}})})).catch((function(){})).then((function(){setTimeout(()=>{m.a.getDevices(e.props.app)},250)}))}}})))))},k=0;k<t.config.portCount;k++)b(k);return v},this.removeUnNecessaryProps=e=>{var t=r({},e),s=["isKegSizeCustom","isDrinkSizeCustom","isServingSizeCustom"];return Object.keys(t).forEach((function(e){s.forEach(s=>delete t[e][s])})),console.log(t),t},this.saveConfiguration=()=>{var e=this,t=c.a.mdashURL+"/api/v2/m/device?access_token="+encodeURIComponent(e.state.pubkey),s={shadow:{state:{desired:{config:e.removeUnNecessaryProps(e.state.c)}}}};return g({method:"POST",url:t,data:s}).then((function(){e.state.c.siteName&&(n.Router.route("/config/"+e.state.c.siteName+"/"+e.props.id+"/"+e.props.port),e.props.name=e.state.c.siteName,e.componentDidMount()),setTimeout(()=>{m.a.getDevices(e.props.app)},750)})).catch((function(){}))}}componentDidMount(){var e=this.props;e.app.setState({headerName:"Settings / "+e.name+" / "+e.id+" / "+(+this.props.port+1),backlink:"/sites/"+e.name}),this.props.app.state.devices&&0===Object.keys(this.props.app.state.devices).length&&this.props.app.state.devices.constructor===Object&&m.a.getDevices(this.props.app)}componentWillReceiveProps(e,t){var s=this.getDevicePubkeyById(e.app,e.id);s&&this.setState({pubkey:s,c:{},d:e.app.state.devices[s]})}render(){if(this.state.d){var e=this.state.d.shadow.state.reported,t=this.getPortConfigs();return Object(i.h)("div",{class:h.a.settings},Object(i.h)("div",{class:"overflow-auto p-2 font-weight-light"},Object(i.h)("div",{class:"px-2 my-2"},this.state.d.id,":",Object(i.h)("b",{class:e.online?"text-success font-weight-bold":"font-weight-bold text-danger"},e.online?" online":" offline")),Object(i.h)("hr",null),Object(i.h)("form",{class:"form px-2"},Object(i.h)(d,{onChange:this.handleMkRowChange,valueResolver:this.mkRowValueResolver,label:"Site Name",k:"siteName"}),Object(i.h)(d,{onChange:this.handleMkRowChange,valueResolver:this.mkRowValueResolver,label:"Alert Email",k:"alertEmail"}),this.mkDropdownRow("Low Alarm","lowThresholdAlertEna",[{value:0,title:"Disable"},{value:1,title:"Enable"}]),Object(i.h)(d,{onChange:this.handleMkRowChange,valueResolver:this.mkRowValueResolver,label:"Low Threshold %",k:"lowThreshold"}),this.mkDropdownRow("Empty Alarm","emptyThresholdAlertEna",[{value:0,title:"Disable"},{value:1,title:"Enable"}]),Object(i.h)(d,{onChange:this.handleMkRowChange,valueResolver:this.mkRowValueResolver,label:"Empty Threshold %",k:"emptyThreshold"}),Object(i.h)(d,{onChange:this.handleMkRowChange,valueResolver:this.mkRowValueResolver,label:"Ports",k:"portCount",extraProps:{disabled:!0}}),Object(i.h)(d,{onChange:this.handleMkRowChange,valueResolver:this.mkRowValueResolver,label:"Hardware",k:"hwRev",extraProps:{disabled:!0}}),Object(i.h)(d,{onChange:this.handleMkRowChange,valueResolver:this.mkRowValueResolver,label:"Firmware",k:"fwRev",extraProps:{disabled:!0}}),Object(i.h)(d,{onChange:this.handleMkRowChange,valueResolver:this.mkRowValueResolver,label:"Serial Number",k:"chipID",extraProps:{disabled:!0}}),Object(i.h)(d,{onChange:this.handleMkRowChange,valueResolver:this.mkRowValueResolver,label:"Model",k:"modelNum",extraProps:{disabled:!0}}),this.mkDropdownRow("Display Units","displayUnits",[{value:0,title:"US Customary"},{value:1,title:"Metric"}]),this.mkDropdownRow("Cleaning Mode","cleanEna",[{value:0,title:"Disable"},{value:1,title:"Enable"}]),this.mkDropdownRow("Beacon Mode","beaconEna",[{value:0,title:"Disable"},{value:1,title:"Enable"}]),this.mkDropdownRow("Auto Keg Reset","autoCounterRstEna",[{value:0,title:"Disable"},{value:1,title:"Enable"}],this.onAutoKegReset),Object(i.h)(v,{open:this.state.autoKegResetAlertOpen,onClose:this.closeAutoKegResetModal},"For best Auto Keg Reset performance, ensure Reset Keg Volume is applied when the first keg is tapped. Calibrating your tap is also recommended."),t,Object(i.h)(u.a,{class:"btn-block btn-primary mt-5",title:"Save Configuration",icon:"fa-save",onClick:this.saveConfiguration}))))}return Object(i.h)("div",{class:h.a.settings},Object(i.h)("div",{class:"h-100 d-flex align-items-center"},Object(i.h)("div",{class:"text-center w-100 text-muted"},Object(i.h)("span",{class:"fa fa-refresh fa-spin fa-2x"}),Object(i.h)("br",null))))}}}}]);
//# sourceMappingURL=route-settings.chunk.f9ee9.esm.js.map