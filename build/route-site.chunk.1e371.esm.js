(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{"/jtX":function(t){t.exports={site:"site__1MWKo"}},"7gvT":function(t,e,s){"use strict";s.r(e),s.d(e,"default",(function(){return l}));var o=s("hosL"),r=(s("Y3FI"),s("/jtX")),a=s.n(r),i=s("jmCe"),n=s("IMbM");class l extends o.Component{constructor(t){super(t),this.kegLevel=t=>t.volSize?+(100*(t.volStart-t.volDisp)/t.volSize).toFixed(2):0,this.mlToUnits=(t,e)=>e?(t/1e3).toFixed(2)+" L":(t/3785.41).toFixed(2)+" gal",this.th=(t,e,s)=>{var r=this;return Object(o.h)("th",{style:void 0===e?"":"cursor: pointer",class:s||"",onClick:function(){void 0!==e&&r.setState({sortColumn:e,direction:r.state.sortColumn==e?-1*r.state.direction:1})}},t)},this.getBar=(t,e)=>{var s="";return t.lowThreshold>0&&e<t.lowThreshold&&(s=" bg-warning"),t.emptyThreshold>0&&e<t.emptyThreshold&&(s=" bg-danger"),e<0&&(s=" text-danger"),Object(o.h)("div",{class:"progress mt-1",style:"min-width: 8em"},Object(o.h)("div",{class:"progress-bar"+s,style:"width:"+(e<0?0:e)+"%",role:"progressbar"},Object(o.h)("span",{class:"px-2"},e,"%")))},this.getKegs=()=>{var t=this,e=t.props.app.state.devices,s=[],o=function(o){var r=e[o],a=r.shadow.state.reported,n=a.config;if((n.siteName||i.a.defaultSiteName)==t.props.name)for(var l=0;l<n.portCount;l++)n["port"+l].d=r,n["port"+l].port=l,n["port"+l].r=a,s.push(n["port"+l])};for(var r in e)o(r);return s.sort((function(e,s){var o=e.userName,r=s.userName;return 1==t.state.sortColumn?(o=e.r.online,r=s.r.online):2==t.state.sortColumn?(o=t.kegLevel(e),r=t.kegLevel(s)):3==t.state.sortColumn?(o=e.volDisp,r=s.volDisp):4==t.state.sortColumn?(o=e.volStart-e.volDisp,r=s.volStart-s.volDisp):5==t.state.sortColumn?(e.drinkSize>0&&(o=(e.volStart-e.volDisp)/e.drinkSize),s.drinkSize>0&&(r=(s.volStart-s.volDisp)/s.drinkSize)):6==t.state.sortColumn&&(o=e.volSize,r=s.volSize),o==r?e.userName>s.userName?1:-1:o>r?1*t.state.direction:-1*t.state.direction})),s},this.state={sortColumn:2,direction:1}}componentDidMount(){this.props.app.setState({headerName:"Sites / "+this.props.name,backlink:"/sites"}),this.props.app.state.devices&&0===Object.keys(this.props.app.state.devices).length&&this.props.app.state.devices.constructor===Object&&n.a.getDevices(this.props.app)}render(){var t=this,e=t.getKegs();return Object(o.h)("div",{class:a.a.site},Object(o.h)("div",{class:"overflow-auto p-2"},Object(o.h)("div",{class:"h-100"},Object(o.h)("table",{class:"w-100 table table-borderless table-sm mt-2"},Object(o.h)("tr",{class:"small border-bottom"},t.th("Name",0),t.th("Status",1),t.th("Level",2,"w-25"),t.th("Vol Served",3),t.th("Vol Remain",4),t.th("Servings Remain",5),t.th("Size",6),Object(o.h)("th",null)),e.map((function(e){var s=e.volStart-e.volDisp,r=t.kegLevel(e),a=e.drinkSize?parseInt(s/e.drinkSize):0,i=e.r,n=i.config.displayUnits||0,l=t.getBar(i.config,r);return Object(o.h)("tr",{},Object(o.h)("td",null,Object(o.h)("a",{href:"/sites/"+t.props.name+"/"+e.d.id+"/"+e.port},e.userName||"Port "+(e.port+1))),Object(o.h)("td",{class:i.online?"text-success":"text-danger"},Object(o.h)("b",null,i.online?"online":"offline")),Object(o.h)("td",null,l),Object(o.h)("td",null,t.mlToUnits(e.volDisp,n)),Object(o.h)("td",{class:s<=0?"bg-danger text-light":""},t.mlToUnits(s,n)),Object(o.h)("td",{class:a<=0?"bg-danger text-light":""},a),Object(o.h)("td",null,t.mlToUnits(e.volSize,n)),Object(o.h)("td",null,Object(o.h)("a",{href:"/config/"+t.props.name+"/"+e.d.id+"/"+e.port},Object(o.h)("span",{class:"fa fa-cog"}))))}))))))}}},IMbM:function(t,e,s){"use strict";s.d(e,"a",(function(){return a}));var o=s("jmCe"),r=s("czhI").default;class a{}a.getDevices=t=>{r.get(o.a.mdashURL+"/customer?access_token="+localStorage.ktok).then((function(e){var s={},a=Object.keys(e.data.pubkeys||{}).map((function(t){var e=o.a.mdashURL+"/api/v2/m/device?access_token="+encodeURIComponent(t);return r({method:"GET",url:e}).then((function(e){s[t]=e.data})).catch((function(){}))}));Promise.all(a).then((function(){t.setState({devices:s})}))}))},a.getAllServings=t=>{r.get(o.a.mdashURL+"/customer?access_token="+localStorage.ktok).then((function(e){var s={},a=e.data.pubkeys||{},i=Object.keys(a).map((function(t){var e=o.a.mdashURL+"/api/v2/m/device/data/servings_all?access_token="+encodeURIComponent(t);return r({method:"GET",url:e}).then((function(e){s[t]=e.data})).catch((function(){}))}));Promise.all(i).then((function(){t.setState({servings:s,pubkeys:a})}))}))}},jmCe:function(t,e){"use strict";e.a={baseURL:"http://localhost:8080/",provisionURL:"http://192.168.4.1",mdashURL:"https://mdash.net",appID:"",callTimeoutMilli:1e4,defaultSiteName:"NewSite",drinkSizes:{1e3:"Liter (1000 mL)",500:"Half Liter (500 mL)",651:"Bomber (651 mL)",568:"UK Pint (568 mL)",473:"US Pint (473 mL)",355:"US Bottle (355 mL)",0:"Custom"},drinkSizes_US:{1e3:"Liter (33.8oz)",500:"Half Liter (16.9 oz)",651:"Bomber (22.0 oz)",568:"UK Pint (19.2 oz)",473:"US Pint (16 oz)",355:"US Bottle (12 oz)",0:"Custom"},kegSizes:{9464:"Half Corny (9.5L)",18927:"Corny (18.9L)",19550:"1/6 Barrel (19.6L)",2e4:"20L",25e3:"25L",29340:"1/4 Barrel (29.3L)",3e4:"30L",40915:"Firkin (40.9L)",5e4:"50L",58670:"1/2 Barrel (58.7L)",0:"Custom"},kegSizes_US:{9464:"Half Corny (2.5 gal)",18927:"Corny (5 gal)",19550:"1/6 Barrel (5.16 gal)",2e4:"20L (5.28 gal)",25e3:"25L (6.6 gal)",29340:"1/4 Barrel (7.75 gal)",3e4:"30L (7.93 gal)",40915:"Firkin (10.81 gal)",5e4:"50L (13.21 gal)",58670:"1/2 Barrel (15.5 gal)",0:"Custom"}}}}]);
//# sourceMappingURL=route-site.chunk.1e371.esm.js.map