(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{IMbM:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var o=n("jmCe"),a=n("czhI").default,s=function(){};s.getDevices=function(t){a.get(o.a.mdashURL+"/customer?access_token="+localStorage.ktok).then((function(e){var n={},s=Object.keys(e.data.pubkeys||{}).map((function(t){var e=o.a.mdashURL+"/api/v2/m/device?access_token="+encodeURIComponent(t);return a({method:"GET",url:e}).then((function(e){n[t]=e.data})).catch((function(){}))}));Promise.all(s).then((function(){t.setState({devices:n})}))}))},s.getAllServings=function(t){a.get(o.a.mdashURL+"/customer?access_token="+localStorage.ktok).then((function(e){var n={},s=e.data.pubkeys||{},i=Object.keys(s).map((function(t){var e=o.a.mdashURL+"/api/v2/m/device/data/servings_all?access_token="+encodeURIComponent(t);return a({method:"GET",url:e}).then((function(e){n[t]=e.data})).catch((function(){}))}));Promise.all(i).then((function(){t.setState({servings:n,pubkeys:s})}))}))}},jmCe:function(t,e){"use strict";e.a={baseURL:"http://localhost:8080/",provisionURL:"http://192.168.4.1",mdashURL:"https://mdash.net",appID:"",callTimeoutMilli:1e4,defaultSiteName:"NewSite",drinkSizes:{1e3:"Liter (1000 mL)",500:"Half Liter (500 mL)",651:"Bomber (651 mL)",568:"UK Pint (568 mL)",473:"US Pint (473 mL)",355:"US Bottle (355 mL)",0:"Custom"},drinkSizes_US:{1e3:"Liter (33.8oz)",500:"Half Liter (16.9 oz)",651:"Bomber (22.0 oz)",568:"UK Pint (19.2 oz)",473:"US Pint (16 oz)",355:"US Bottle (12 oz)",0:"Custom"},kegSizes:{9464:"Half Corny (9.5L)",18927:"Corny (18.9L)",19550:"1/6 Barrel (19.6L)",2e4:"20L",25e3:"25L",29340:"1/4 Barrel (29.3L)",3e4:"30L",40915:"Firkin (40.9L)",5e4:"50L",58670:"1/2 Barrel (58.7L)",0:"Custom"},kegSizes_US:{9464:"Half Corny (2.5 gal)",18927:"Corny (5 gal)",19550:"1/6 Barrel (5.16 gal)",2e4:"20L (5.28 gal)",25e3:"25L (6.6 gal)",29340:"1/4 Barrel (7.75 gal)",3e4:"30L (7.93 gal)",40915:"Firkin (10.81 gal)",5e4:"50L (13.21 gal)",58670:"1/2 Barrel (15.5 gal)",0:"Custom"}}},m55C:function(t){t.exports={login:"login__1zeTF"}},n6wl:function(t,e,n){"use strict";function o(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}n.r(e);var a=n("hosL"),s=n("Y3FI"),i=n("eWb4"),r=(n("ylD8"),function(t){function e(e){var n;return(n=t.call(this,e)||this).onToggle=function(t){var e=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(n);t.preventDefault(),e.setState({expanded:!e.state.expanded})},n.state={expanded:e.expanded||!1},n}var n,o;return o=t,(n=e).prototype=Object.create(o.prototype),n.prototype.constructor=n,n.__proto__=o,e.prototype.render=function(){this.state.expanded||this.props.dnone&&Object(a.h)("div",{class:"d-none"},this.props.children);return Object(a.h)("span",{class:this.props.class||"",style:"z-index: 999"},Object(a.h)("a",{onClick:this.onToggle,href:"#"},this.props.text||"",Object(a.h)("i",{class:"ml-2 fa "+(this.state.expanded?"fa-caret-down":"fa-caret-right")})),this.props.extra,this.state.expanded?this.props.children:this.props.dnone?Object(a.h)("div",{class:"d-none"},this.props.children):null)},e}(a.Component)),c=n("m55C"),l=n.n(c),p=n("jmCe"),u=n("IMbM");n.d(e,"default",(function(){return d}));var h=n("czhI").default,d=function(t){function e(e){var n;return(n=t.call(this,e)||this).componentDidMount=function(){var t=o(n);localStorage.ktok&&s.Router.route("/sites"),window.app=t,t.state.devices={};var e={},a="",i=location.href.match(/\?(\w+)=(.+)$/);i&&"creds"==i[1]&&i[2]?e.headers={Authorization:"Basic "+btoa(decodeURIComponent(i[2]))}:i&&"access_token"==i[1]&&i[2]&&(a=i[2]),a||(a=localStorage.ktok);var r=a?"?access_token="+a:"";(e.headers||r)&&h.get(p.a.mdashURL+"/customer"+r,e).then((function(e){t.login(e.data)})).catch((function(){}))},n.login=function(t){var e=o(n);t&&t.token&&(localStorage.ktok=t.token,e.props.app.setState({ktok:t.token}),u.a.getDevices(e.props.app),u.a.getAllServings(e.props.app)),location.href.indexOf("?")>0&&(location.href=location.href.replace(/\?.*/,""))},n.onEmailInput=function(t){n.setState({email:t.target.value})},n.onPasswordInput=function(t){n.setState({pass:t.target.value})},n.onSignIn=function(){var t=o(n);return h.get(p.a.mdashURL+"/customer",{headers:{Authorization:"Basic "+btoa(t.state.email+":"+t.state.pass)}}).then((function(e){t.login(e.data),s.Router.route("/sites")})).catch((function(t){alert((((t.response||{}).data||{}).error||{}).message||t.message||t)}))},n.onSendInvitation=function(){var t=o(n),e=p.a.appID||location.pathname.split("/")[2]||"setme",a={email:t.state.email,url:p.a.mdashURL,from:"Kegtron",redir:location.href,app_id:e,text:"Thank you for registering with Kegtron.\nYour login: EMAIL\nYour password: PASS\nClick on the link below to activate your account and login:\nREGLINK"};return h.post(p.a.mdashURL+"/invite",a).then((function(){alert("Thank you! Check your inbox and login."),t.setState({email:""}),location.reload()})).catch((function(t){alert((((t.response||{}).data||{}).error||{}).message||t.message||t)}))},n.state={email:"",pass:""},n}var n,c;return c=t,(n=e).prototype=Object.create(c.prototype),n.prototype.constructor=n,n.__proto__=c,e.prototype.render=function(){return Object(a.h)("div",{class:l.a.login,style:"width:100%; height: 100%; background-color: #000"},Object(a.h)("div",{class:"mx-auto bg-light rounded",style:"max-width: 480px"},Object(a.h)("img",{src:"assets/images/Kegtron Cloud Dashboard - bw.png",class:"img-fluid"}),Object(a.h)("div",{class:"form p-3 rounded w-100"},Object(a.h)("input",{type:"email",placeholder:"Email",class:"my-2 form-control",onInput:this.onEmailInput}),Object(a.h)("input",{type:"password",placeholder:"Password",class:"my-2 form-control",onInput:this.onPasswordInput}),Object(a.h)(i.a,{class:"btn-block btn-secondary",disabled:!this.state.email||!this.state.pass,title:"Sign In",style:"backgroundColor: #000",icon:"fa-sign-in",onClick:this.onSignIn}),Object(a.h)("div",{class:"mt-2"},"No account yet?",Object(a.h)(r,{text:" Register",class:"black-text"},Object(a.h)("div",null,Object(a.h)("input",{type:"email",placeholder:"Email",class:"my-2 form-control",onInput:this.onEmailInput}),Object(a.h)(i.a,{class:"btn-block btn-secondary",icon:"fa-envelope",style:"backgroundColor: #000",title:"Send invitation",disabled:!this.state.email,onClick:this.onSendInvitation})))),Object(a.h)("div",{class:"mt-2"},Object(a.h)("small",null,"By using this service, you agree to the",Object(a.h)("a",{href:"https://policies.google.com/terms",class:"black-text"}," terms"))))))},e}(a.Component)},ylD8:function(t){t.exports={toggle:"toggle__2CfFO"}}}]);
//# sourceMappingURL=route-login.chunk.c9530.js.map