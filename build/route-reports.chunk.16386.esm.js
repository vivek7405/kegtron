(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{R2Tw:function(t){t.exports={reports:"reports__24zUv"}},WHFn:function(t,e,l){"use strict";l.r(e),l.d(e,"default",(function(){return c}));var s=l("hosL"),r=l("eWb4"),n=(l("R2Tw"),l("IMbM")),a=l("TiKg"),h=l.n(a);class c extends s.Component{constructor(t){super(t),this.getHeader=()=>Object(s.h)("div",null,Object(s.h)("div",{class:"col-12 d-flex justify-content-center form-inline",style:"flex-wrap: wrap"},Object(s.h)("div",{class:"d-flex form-inline"},Object(s.h)("input",{type:"radio",name:"servings",value:"keg",checked:this.state.servingsByKegChecked,onChange:this.servingsByChanged})," ",Object(s.h)("label",{class:"col-form-label"},"Servings By Keg")),Object(s.h)("div",{class:"d-flex form-inline",style:"margin-left: 3%"},Object(s.h)("input",{type:"radio",name:"servings",value:"time",checked:this.state.servingsByTimeChecked,onChange:this.servingsByChanged})," ",Object(s.h)("label",{class:"col-form-label"},"Servings By Time"))),Object(s.h)("br",null),Object(s.h)("div",{class:"col-12 d-flex justify-content-center",style:"flex-wrap: wrap"},Object(s.h)("div",{class:"col-4 d-flex justify-content-center form-inline"},Object(s.h)("label",{class:"col-form-label"},"Range"),Object(s.h)("select",{class:"form-control",style:"margin-left: 2%",type:"text",value:this.state.selectedDateOption,onChange:this.dateOptionChanged},Object(s.h)("option",{value:"today"},"Today"),Object(s.h)("option",{value:"yesterday"},"Yesterday"),Object(s.h)("option",{value:"weekToDate"},"Week to Date"),Object(s.h)("option",{value:"lastWeek"},"Last Week"),Object(s.h)("option",{value:"monthToDate"},"Month To Date"),Object(s.h)("option",{value:"lastMonth"},"Last Month"),Object(s.h)("option",{value:"yearToDate"},"Year to Date"),Object(s.h)("option",{value:"custom"},"Custom"))),"custom"==this.state.selectedDateOption&&Object(s.h)("div",{class:"col-4 d-flex justify-content-center form-inline"},Object(s.h)("label",{class:"col-form-label"},"Start"),Object(s.h)("input",{class:"form-control",style:"margin-left: 2%",type:"date",value:this.state.start,onChange:this.startDateChanged})),"custom"==this.state.selectedDateOption&&Object(s.h)("div",{class:"col-4 d-flex justify-content-center form-inline"},Object(s.h)("label",{class:"col-form-label"},"End"),Object(s.h)("input",{class:"form-control",style:"margin-left: 2%",type:"date",value:this.state.end,onChange:this.endDateChanged})),"custom"!=this.state.selectedDateOption&&Object(s.h)("div",{class:"col-4 d-flex justify-content-center form-inline"},Object(s.h)("label",{class:"col-form-label"},"Start"),Object(s.h)("input",{disabled:!0,class:"form-control",style:"margin-left: 2%",type:"date",value:this.state.start,onChange:this.startDateChanged})),"custom"!=this.state.selectedDateOption&&Object(s.h)("div",{class:"col-4 d-flex justify-content-center form-inline"},Object(s.h)("label",{class:"col-form-label"},"End"),Object(s.h)("input",{disabled:!0,class:"form-control",style:"margin-left: 2%",type:"date",value:this.state.end,onChange:this.endDateChanged}))),Object(s.h)("br",null),Object(s.h)("div",{class:"col-12 d-flex justify-content-center",style:"flex-wrap: wrap"},Object(s.h)(r.a,{class:"d-inline-block ml-3 btn-warning font-weight-light",style:"background-color: antiquewhite",icon:"fa-print",title:"Print",onClick:this.print}),Object(s.h)(r.a,{class:"d-inline-block ml-3 btn-warning font-weight-light",style:"background-color: antiquewhite",icon:"fa-file-excel-o",title:"Export As CSV",onClick:this.exportAsCSV}))),this.dateOptionChanged=t=>{var e,l,s="YYYY-MM-DD",r=t.srcElement.value;"today"==r?(e=h()().format(s),l=h()().format(s)):"yesterday"==r?(e=h()().add(-1,"days").format(s),l=h()().add(-1,"days").format(s)):"weekToDate"==r?(e=h()().startOf("isoWeek").format(s),l=h()().format(s)):"lastWeek"==r?(e=h()().subtract(1,"weeks").startOf("isoWeek").format(s),l=h()().subtract(1,"weeks").endOf("isoWeek").format(s)):"monthToDate"==r?(e=h()().startOf("month").format(s),l=h()().format(s)):"lastMonth"==r?(e=h()().subtract(1,"months").startOf("month").format(s),l=h()().subtract(1,"months").endOf("month").format(s)):"yearToDate"==r?(e=h()().startOf("year").format(s),l=h()().format(s)):(e="",l=""),this.setState({selectedDateOption:r,start:e,end:l})},this.startDateChanged=t=>{this.setState({start:t.srcElement.value})},this.endDateChanged=t=>{this.setState({end:t.srcElement.value})},this.servingsByChanged=()=>{this.setState({servingsByKegChecked:!this.state.servingsByKegChecked,servingsByTimeChecked:!this.state.servingsByTimeChecked})},this.print=()=>{var t=document.getElementById("nodeToRenderAsPDF").innerHTML,e=window.open("","","height=400,width=800");e.document.write("<html><head><title>Kegtron Serving Report</title>"),e.document.write("</head><body>"),e.document.write(t),e.document.write("</body></html>"),e.document.close(),e.print()},this.downloadCSV=(t,e)=>{var l,s;l=new Blob([t],{type:"text/csv"}),(s=document.createElement("a")).download=e,s.href=window.URL.createObjectURL(l),s.style.display="none",document.body.appendChild(s),s.click()},this.exportAsCSV=()=>{for(var t=[],e=document.getElementById("servingsForCSV").querySelectorAll("table tr"),l=0;l<e.length;l++){for(var s=[],r=e[l].querySelectorAll("td, th"),n=0;n<r.length;n++)s.push(r[n].innerText);t.push(s.join(","))}this.downloadCSV(t.join("\n").replace("Serving Report: ",""),"Kegtron Serving Report.csv")},this.mlToUnits=(t,e)=>e?e.displayUnits?+t+" mL":(.033814*+t).toFixed(1)+" oz":+t+" mL",this.mlToUnitsWoUnit=(t,e)=>e?e.displayUnits?+t:(.033814*+t).toFixed(1):+t,this.mlToUnits2=(t,e)=>e?e.displayUnits?(t/1e3).toFixed(2)+" L":(t/3785.41).toFixed(2)+" gal":(t/1e3).toFixed(2)+" L",this.getServingsForCSV=()=>{var t,e,l=this.props.app.state.devices,r=0,n=new Array;if(0!=Object.keys(l).length){for(var a in this.props.app.state.pubkeys){var c=l[a].id,i=l[a].shadow.state.reported.config;e=i;var o=this.props.app.state.servings[a];if(null!=o&&o.rows.length>0)for(var b=0;b<i.portCount;b++){var d=i["port"+b];if(null!=d){var u=d.userName,O=0;for(var j in o.rows){var p=o.rows[j];if(c==p[1]){var v=JSON.parse(p[3]);if(v.port==b&&v.vol>0){var g=h.a.utc(p[0]).local().format("YYYY-MM-DD");if(g>=this.state.start&&g<=this.state.end){var m=h.a.utc(p[0]).local().format("YYYY-MM-DD");if(m>=this.state.start&&m<=this.state.end){m=h.a.utc(p[0]).local().format("YYYY-MM-DD HH:mm");var f=JSON.parse(p[3]);n.push(Object(s.h)("tr",null,Object(s.h)("td",null,m),Object(s.h)("td",null,u),Object(s.h)("td",null,this.mlToUnitsWoUnit(f.vol,i))))}O++}}}}O>0&&(r+=O)}}}if(r>0){var y="mL";e&&(y=e.displayUnits?"mL":"oz"),t=Object(s.h)("table",{border:"1",style:"text-align: center; width: 100%"},Object(s.h)("tr",null,Object(s.h)("th",null,"Date / Time"),Object(s.h)("th",null,"Keg Name"),Object(s.h)("th",null,"Serving Size (",y,")")),n)}else t=Object(s.h)("table",{border:"0"},Object(s.h)("tr",null,Object(s.h)("td",null,"No data available for selected range.")))}return t},this.getServingsByKeg=()=>{var t=this.props.app.state.devices,e=new Array,l=new Array,r=0,n=0,a=void 0;if(0!=Object.keys(t).length){for(var c in this.props.app.state.pubkeys){var i=t[c].id,o=t[c].shadow.state.reported.config;a=o;var b=this.props.app.state.servings[c];if(null!=b&&b.rows.length>0){b.rows.sort();for(var d=0;d<o.portCount;d++){var u,O=new Array,j=o["port"+d];if(null!=j){var p=j.userName,v=j.userDesc,g=this.mlToUnits2(j.volSize,o),m=j.dateTapped?h()(j.dateTapped||void 0).fromNow().replace(" ago",""):"-";u=Object(s.h)("table",{border:"0"},Object(s.h)("tr",null,Object(s.h)("td",null,"Name"),Object(s.h)("td",null,": ",Object(s.h)("b",null,p))),Object(s.h)("tr",null,Object(s.h)("td",null,"Description"),Object(s.h)("td",null,": ",Object(s.h)("b",null,v))),Object(s.h)("tr",null,Object(s.h)("td",null,"Keg Size"),Object(s.h)("td",null,": ",Object(s.h)("b",null,g))),Object(s.h)("tr",null,Object(s.h)("td",null,"Days On Tap"),Object(s.h)("td",null,": ",Object(s.h)("b",null,m))));var f=0,y=0;for(var w in b.rows){var D=b.rows[w];if(i==D[1]){var S=h.a.utc(D[0]).local().format("YYYY-MM-DD");if(S>=this.state.start&&S<=this.state.end){S=h.a.utc(D[0]).local().format("YYYY-MM-DD HH:mm");var T=JSON.parse(D[3]);T.port==d&&T.vol>0&&(O.push(Object(s.h)("tr",null,Object(s.h)("td",null,S),Object(s.h)("td",null,this.mlToUnits(T.vol,o)))),y+=T.vol,f++)}}}if(f>0){r+=f,n+=y;var k=Object(s.h)("table",{border:"1",style:"text-align: center; width: 100%"},Object(s.h)("tr",null,Object(s.h)("th",null,"Date / Time"),Object(s.h)("th",null,"Serving Size")),O);e.push(Object(s.h)("div",null,u)),e.push(Object(s.h)("table",{border:"0"},Object(s.h)("tr",null,Object(s.h)("td",null,Object(s.h)("br",null))))),e.push(Object(s.h)("div",null,k)),e.push(Object(s.h)("table",{border:"0"},Object(s.h)("tr",null,Object(s.h)("td",null,Object(s.h)("br",null))))),e.push(Object(s.h)("table",{border:"0"},Object(s.h)("tr",null,Object(s.h)("td",null,Object(s.h)("b",null,"Total Servings: "),f,", ",Object(s.h)("b",null,"Total Volume: "),this.mlToUnits2(y,o))))),e.push(Object(s.h)("table",{border:"0"},Object(s.h)("tr",null,Object(s.h)("td",null,Object(s.h)("br",null),Object(s.h)("br",null))))),l.push(Object(s.h)("tr",null,Object(s.h)("td",null,p),Object(s.h)("td",null,f),Object(s.h)("td",null,this.mlToUnits2(y,o))))}}}}}if(l.length>0){e.splice(0,0,Object(s.h)("table",{border:"0",style:"text-align: center; width: 100%"},Object(s.h)("tr",null,Object(s.h)("td",{style:"font-size: x-large"},Object(s.h)("b",null,"Serving Report: ",this.state.start," - ",this.state.end),Object(s.h)("br",null),Object(s.h)("br",null))))),e.splice(0,0,Object(s.h)("table",{border:"0",style:"text-align: center; width: 100%"},Object(s.h)("tr",null,Object(s.h)("td",null,Object(s.h)("br",null),Object(s.h)("img",{src:"/assets/images/KegtronLogoBlack.png",height:"24"}),Object(s.h)("br",null)))));var Y=Object(s.h)("table",{border:"1",style:"text-align: center; width: 100%"},Object(s.h)("tr",null,Object(s.h)("th",null,"Keg Name"),Object(s.h)("th",null,"Servings"),Object(s.h)("th",null,"Volume Served")),l);e.push(Object(s.h)("table",{border:"0",style:"text-align: center; width: 100%"},Object(s.h)("tr",null,Object(s.h)("td",{style:"font-size: x-large"},Object(s.h)("b",null,"Grand Total"),Object(s.h)("br",null),Object(s.h)("br",null))))),e.push(Object(s.h)("div",{style:"text-align: center"},Y)),e.push(Object(s.h)("table",{border:"0"},Object(s.h)("tr",null,Object(s.h)("td",null,Object(s.h)("br",null))))),e.push(Object(s.h)("table",{border:"0"},Object(s.h)("tr",null,Object(s.h)("td",null,Object(s.h)("b",null,"Total Servings: "),r,", ",Object(s.h)("b",null,"Total Volume: "),this.mlToUnits2(n,a))))),e.push(Object(s.h)("table",{border:"0"},Object(s.h)("tr",null,Object(s.h)("td",null,Object(s.h)("br",null),Object(s.h)("br",null)))))}else(e=new Array).push(Object(s.h)("table",{border:"0"},Object(s.h)("tr",null,Object(s.h)("td",null,"No data available for selected range."))))}return e},this.getServingsByTime=()=>{var t,e=this.props.app.state.devices,l=new Array,r=new Array,n=0,a=0,c=new Array;if(0!=Object.keys(e).length){for(var i in this.props.app.state.pubkeys){var o=e[i].id,b=e[i].shadow.state.reported.config;t=b;var d=this.props.app.state.servings[i];if(null!=d&&d.rows.length>0)for(var u=0;u<b.portCount;u++){var O=b["port"+u];if(null!=O){var j=O.userName,p=0,v=0;for(var g in d.rows){var m=d.rows[g];if(o==m[1]){var f=JSON.parse(m[3]);if(f.port==u&&f.vol>0){var y=h.a.utc(m[0]).local().format("YYYY-MM-DD");if(y>=this.state.start&&y<=this.state.end){var w=h.a.utc(m[0]).local().format("YYYY-MM-DD");if(w>=this.state.start&&w<=this.state.end){w=h.a.utc(m[0]).local().format("YYYY-MM-DD HH:mm");var D=JSON.parse(m[3]);c.push(Object(s.h)("tr",null,Object(s.h)("td",null,w),Object(s.h)("td",null,j),Object(s.h)("td",null,this.mlToUnits(D.vol,b))))}v+=f.vol,p++}}}}p>0&&(n+=p,a+=v,r.push(Object(s.h)("tr",null,Object(s.h)("td",null,j),Object(s.h)("td",null,p),Object(s.h)("td",null,this.mlToUnits2(v,b)))))}}}if(r.length>0){l.push(Object(s.h)("table",{border:"0",style:"text-align: center; width: 100%"},Object(s.h)("tr",null,Object(s.h)("td",null,Object(s.h)("br",null),Object(s.h)("img",{src:"/assets/images/KegtronLogoBlack.png",height:"24"}),Object(s.h)("br",null))))),l.push(Object(s.h)("table",{border:"0",style:"text-align: center; width: 100%"},Object(s.h)("tr",null,Object(s.h)("td",{style:"font-size: x-large"},Object(s.h)("b",null,"Serving Report: ",this.state.start," - ",this.state.end),Object(s.h)("br",null),Object(s.h)("br",null)))));var S=Object(s.h)("table",{border:"1",style:"text-align: center; width: 100%"},Object(s.h)("tr",null,Object(s.h)("th",null,"Date / Time"),Object(s.h)("th",null,"Keg Name"),Object(s.h)("th",null,"Serving Size")),c);l.push(S);var T=Object(s.h)("table",{border:"1",style:"text-align: center; width: 100%"},Object(s.h)("tr",null,Object(s.h)("th",null,"Keg Name"),Object(s.h)("th",null,"Servings"),Object(s.h)("th",null,"Volume Served")),r);l.push(Object(s.h)("table",{border:"0"},Object(s.h)("tr",null,Object(s.h)("td",null,Object(s.h)("br",null),Object(s.h)("br",null))))),l.push(Object(s.h)("table",{border:"0",style:"text-align: center; width: 100%"},Object(s.h)("tr",null,Object(s.h)("td",{style:"font-size: x-large"},Object(s.h)("b",null,"Grand Total"),Object(s.h)("br",null),Object(s.h)("br",null))))),l.push(Object(s.h)("div",{style:"text-align: center"},T)),l.push(Object(s.h)("table",{border:"0"},Object(s.h)("tr",null,Object(s.h)("td",null,Object(s.h)("br",null))))),l.push(Object(s.h)("table",{border:"0"},Object(s.h)("tr",null,Object(s.h)("td",null,Object(s.h)("b",null,"Total Servings: "),n,", ",Object(s.h)("b",null,"Total Volume: "),this.mlToUnits2(a,t))))),l.push(Object(s.h)("table",{border:"0"},Object(s.h)("tr",null,Object(s.h)("td",null,Object(s.h)("br",null),Object(s.h)("br",null)))))}else(l=new Array).push(Object(s.h)("table",{border:"0"},Object(s.h)("tr",null,Object(s.h)("td",null,"No data available for selected range."))))}return l},this.state={start:h()().format("YYYY-MM-DD"),end:h()().format("YYYY-MM-DD"),selectedDateOption:"today",servingsByKegChecked:!0,servingsByTimeChecked:!1}}componentDidMount(){this.props.app.setState({headerName:"Reports",backlink:""}),this.props.app.state.servings&&0===Object.keys(this.props.app.state.servings).length&&this.props.app.state.servings.constructor===Object&&n.a.getAllServings(this.props.app),this.props.app.state.devices&&0===Object.keys(this.props.app.state.devices).length&&this.props.app.state.devices.constructor===Object&&n.a.getDevices(this.props.app)}render(){return Object(s.h)("div",{class:"overflow-auto p-2"},Object(s.h)("div",{class:"card-deck col-12"},Object(s.h)("div",{class:"card"},Object(s.h)("div",{class:"card-header font-weight-bold"},this.getHeader()),Object(s.h)("div",{id:"nodeToRenderAsPDF",class:"card-body table-responsive"},this.state.servingsByKegChecked&&this.getServingsByKeg(),this.state.servingsByTimeChecked&&this.getServingsByTime()),Object(s.h)("div",{id:"servingsForCSV",style:"display: none"},this.getServingsForCSV()))))}}}}]);
//# sourceMappingURL=route-reports.chunk.16386.esm.js.map